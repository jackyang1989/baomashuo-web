import React, { useState } from 'react';
import { ArrowLeft, X, Plus, Star, TrendingUp, Users, ThumbsUp, ThumbsDown, AlertTriangle, CheckCircle, ChevronDown, ChevronUp, ShoppingCart, Share2, Zap } from 'lucide-react';

const ProductComparePage = () => {
  const [products, setProducts] = useState([
    {
      id: 1,
      name: 'Comotomoå¯ä¹ˆå¤šä¹ˆç¡…èƒ¶å¥¶ç“¶',
      brand: 'Comotomo',
      image: 'ğŸ¼',
      price: 128,
      originalPrice: 189,
      rating: 4.8,
      reviewCount: 234,
      recommendRate: 82,
      stillUsingRate: 81,
      repurchaseRate: 38
    },
    {
      id: 2,
      name: 'Dr.Brownå¸ƒæœ—åšå£«é˜²èƒ€æ°”å¥¶ç“¶',
      brand: 'Dr.Brown',
      image: 'ğŸ¼',
      price: 98,
      originalPrice: 158,
      rating: 4.6,
      reviewCount: 189,
      recommendRate: 76,
      stillUsingRate: 74,
      repurchaseRate: 32
    },
    null // ç©ºä½ï¼Œå¯æ·»åŠ ç¬¬ä¸‰ä¸ªäº§å“
  ]);

  const [expandedSections, setExpandedSections] = useState({
    basic: true,
    score: true,
    pros: true,
    cons: true,
    params: false
  });

  // å¯¹æ¯”æ•°æ®
  const compareData = {
    dimensions: [
      { id: 1, name: 'é˜²èƒ€æ°”æ•ˆæœ', scores: [4.7, 4.5, null], unit: 'åˆ†' },
      { id: 2, name: 'å®å®æ¥å—åº¦', scores: [4.6, 4.3, null], unit: 'åˆ†' },
      { id: 3, name: 'æ¸…æ´—éš¾åº¦', scores: [4.8, 4.2, null], unit: 'åˆ†' },
      { id: 4, name: 'è€ç”¨æ€§', scores: [4.4, 4.6, null], unit: 'åˆ†' },
      { id: 5, name: 'æ€§ä»·æ¯”', scores: [4.3, 4.5, null], unit: 'åˆ†' }
    ],
    pros: [
      {
        product1: ['å¥¶å˜´æŸ”è½¯åº¦æ¥è¿‘æ¯ä¹³ï¼ˆ89%ï¼‰', 'é˜²èƒ€æ°”æ•ˆæœæ˜æ˜¾ï¼ˆ76%ï¼‰', 'å®½å£è®¾è®¡æ˜“æ¸…æ´—ï¼ˆ68%ï¼‰'],
        product2: ['ä¸“åˆ©å¯¼ç®¡é˜²èƒ€æ°”ï¼ˆ82%ï¼‰', 'åŒ»ç”Ÿæ¨èç‡é«˜ï¼ˆ71%ï¼‰', 'ä»·æ ¼ç›¸å¯¹å®æƒ ï¼ˆ65%ï¼‰']
      }
    ],
    cons: [
      {
        product1: ['ä»·æ ¼åé«˜ï¼ˆ32%ï¼‰', 'å¥¶å˜´åè½¯æµé€Ÿå¿«ï¼ˆ18%ï¼‰', 'ç¡…èƒ¶æ˜“æ²¾ç°ï¼ˆ15%ï¼‰'],
        product2: ['é…ä»¶å¤šæ¸…æ´—éº»çƒ¦ï¼ˆ45%ï¼‰', 'å¯¼ç®¡å®¹æ˜“å µï¼ˆ28%ï¼‰', 'å¥¶å˜´åç¡¬ï¼ˆ22%ï¼‰']
      }
    ],
    params: [
      { name: 'æè´¨', values: ['ç¡…èƒ¶', 'PP', null] },
      { name: 'å®¹é‡', values: ['150ml/250ml', '120ml/240ml', null] },
      { name: 'é€‚ç”¨æœˆé¾„', values: ['0-18ä¸ªæœˆ', '0-12ä¸ªæœˆ', null] },
      { name: 'é˜²èƒ€æ°”è®¾è®¡', values: ['ç¡…èƒ¶ç“¶èº«', 'ä¸“åˆ©å¯¼ç®¡', null] },
      { name: 'å¥¶å˜´å‹å·', values: ['æ…¢é€Ÿ/ä¸­é€Ÿ', '0-4çº§', null] },
      { name: 'äº§åœ°', values: ['éŸ©å›½', 'ç¾å›½', null] }
    ]
  };

  // æ›¿ä»£äº§å“æ¨è
  const alternatives = [
    { id: 3, name: 'NUKè‡ªç„¶å®æ„Ÿå¥¶ç“¶', brand: 'NUK', image: 'ğŸ¼', price: 78, rating: 4.5 },
    { id: 4, name: 'Pigeonè´äº²å¥¶ç“¶', brand: 'Pigeon', image: 'ğŸ¼', price: 68, rating: 4.4 }
  ];

  const handleRemoveProduct = (index) => {
    const newProducts = [...products];
    newProducts[index] = null;
    setProducts(newProducts);
  };

  const handleAddProduct = (index) => {
    // è·³è½¬åˆ°äº§å“é€‰æ‹©é¡µé¢
  };

  const toggleSection = (section) => {
    setExpandedSections({
      ...expandedSections,
      [section]: !expandedSections[section]
    });
  };

  const getMaxScore = (scores) => {
    const validScores = scores.filter(s => s !== null);
    return Math.max(...validScores);
  };

  const renderProductHeader = (product, index) => (
    <div className="flex-1 min-w-0">
      {product ? (
        <div className="bg-white rounded-2xl p-3 border-2 border-gray-200 relative">
          <button
            onClick={() => handleRemoveProduct(index)}
            className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center z-10"
          >
            <X className="w-4 h-4" />
          </button>
          
          <div className="aspect-square bg-gray-100 rounded-xl flex items-center justify-center text-5xl mb-2">
            {product.image}
          </div>
          
          <div className="text-xs text-gray-500 mb-1">{product.brand}</div>
          <div className="font-semibold text-sm text-gray-800 line-clamp-2 mb-2 h-10">
            {product.name}
          </div>
          
          <div className="flex items-baseline gap-1 mb-2">
            <span className="text-lg font-bold text-red-500">Â¥{product.price}</span>
            <span className="text-xs text-gray-400 line-through">Â¥{product.originalPrice}</span>
          </div>
          
          <div className="flex items-center gap-1 mb-1">
            <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
            <span className="text-sm font-semibold">{product.rating}</span>
            <span className="text-xs text-gray-500">({product.reviewCount})</span>
          </div>
          
          <div className="text-xs text-green-600 font-semibold">
            {product.recommendRate}%æ¨è
          </div>
        </div>
      ) : (
        <button
          onClick={() => handleAddProduct(index)}
          className="w-full aspect-square border-2 border-dashed border-gray-300 rounded-2xl flex flex-col items-center justify-center hover:border-blue-500 transition-all"
        >
          <Plus className="w-8 h-8 text-gray-400 mb-2" />
          <span className="text-sm text-gray-600">æ·»åŠ äº§å“</span>
        </button>
      )}
    </div>
  );

  const renderCompareSection = (title, icon, sectionKey, content) => (
    <div className="bg-white rounded-2xl overflow-hidden border border-gray-200 mb-3">
      <button
        onClick={() => toggleSection(sectionKey)}
        className="w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50"
      >
        <div className="flex items-center gap-2">
          {icon}
          <span className="font-bold text-gray-800">{title}</span>
        </div>
        {expandedSections[sectionKey] ? (
          <ChevronUp className="w-5 h-5 text-gray-400" />
        ) : (
          <ChevronDown className="w-5 h-5 text-gray-400" />
        )}
      </button>
      
      {expandedSections[sectionKey] && (
        <div className="px-4 pb-4">
          {content}
        </div>
      )}
    </div>
  );

  const renderBasicInfo = () => (
    <div className="space-y-3">
      {/* çœŸå®ä½¿ç”¨æ•°æ® */}
      <div>
        <div className="text-xs text-gray-600 mb-2">çœŸå®ä½¿ç”¨æ•°æ®</div>
        <div className="grid grid-cols-3 gap-2">
          {products.map((product, index) => (
            <div key={index} className="bg-gray-50 rounded-lg p-2">
              {product ? (
                <div className="space-y-1">
                  <div className="text-center">
                    <div className="text-lg font-bold text-blue-600">{product.stillUsingRate}%</div>
                    <div className="text-xs text-gray-600">ä»åœ¨ä½¿ç”¨</div>
                  </div>
                  <div className="text-center">
                    <div className="text-sm font-semibold text-purple-600">{product.repurchaseRate}%</div>
                    <div className="text-xs text-gray-600">å›è´­ç‡</div>
                  </div>
                </div>
              ) : (
                <div className="text-center text-gray-400">-</div>
              )}
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const renderScores = () => (
    <div className="space-y-3">
      {compareData.dimensions.map((dimension) => {
        const maxScore = getMaxScore(dimension.scores);
        return (
          <div key={dimension.id}>
            <div className="text-xs text-gray-600 mb-2">{dimension.name}</div>
            <div className="grid grid-cols-3 gap-2">
              {dimension.scores.map((score, index) => (
                <div
                  key={index}
                  className={`rounded-lg p-2 text-center ${
                    score === maxScore && score !== null
                      ? 'bg-green-100 border-2 border-green-500'
                      : 'bg-gray-50'
                  }`}
                >
                  {score !== null ? (
                    <>
                      <div className={`text-lg font-bold ${
                        score === maxScore ? 'text-green-600' : 'text-gray-800'
                      }`}>
                        {score}
                      </div>
                      <div className="text-xs text-gray-500">{dimension.unit}</div>
                    </>
                  ) : (
                    <div className="text-gray-400">-</div>
                  )}
                </div>
              ))}
            </div>
          </div>
        );
      })}
    </div>
  );

  const renderProsAndCons = (type) => {
    const data = type === 'pros' ? compareData.pros[0] : compareData.cons[0];
    const icon = type === 'pros' ? <ThumbsUp className="w-4 h-4 text-green-600" /> : <ThumbsDown className="w-4 h-4 text-red-600" />;
    
    return (
      <div className="grid grid-cols-3 gap-2">
        {products.map((product, index) => (
          <div key={index}>
            {product ? (
              <div className="space-y-2">
                {data[`product${index + 1}`]?.map((item, i) => (
                  <div
                    key={i}
                    className={`text-xs p-2 rounded-lg ${
                      type === 'pros' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'
                    }`}
                  >
                    {item}
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center text-gray-400 text-xs">-</div>
            )}
          </div>
        ))}
      </div>
    );
  };

  const renderParams = () => (
    <div className="space-y-3">
      {compareData.params.map((param, index) => (
        <div key={index}>
          <div className="text-xs text-gray-600 mb-2">{param.name}</div>
          <div className="grid grid-cols-3 gap-2">
            {param.values.map((value, i) => (
              <div key={i} className="bg-gray-50 rounded-lg p-2 text-center">
                {value !== null ? (
                  <div className="text-xs text-gray-800">{value}</div>
                ) : (
                  <div className="text-gray-400">-</div>
                )}
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  );

  return (
    <div className="max-w-md mx-auto bg-gray-50 min-h-screen flex flex-col">
      {/* é¡¶éƒ¨å¯¼èˆª */}
      <div className="bg-white px-4 py-3 flex items-center justify-between shadow-sm sticky top-0 z-50">
        <button className="flex items-center gap-2">
          <ArrowLeft className="w-5 h-5" />
          <span className="font-semibold">äº§å“å¯¹æ¯”</span>
        </button>
        <button>
          <Share2 className="w-5 h-5 text-gray-600" />
        </button>
      </div>

      {/* äº§å“å¤´éƒ¨ */}
      <div className="bg-white p-4 border-b sticky top-14 z-40">
        <div className="flex gap-3">
          {products.map((product, index) => (
            <React.Fragment key={index}>
              {renderProductHeader(product, index)}
            </React.Fragment>
          ))}
        </div>
      </div>

      {/* å¯¹æ¯”å†…å®¹ */}
      <div className="flex-1 overflow-y-auto p-4 pb-24">
        {/* æ™ºèƒ½æ¨èç»“è®º */}
        <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-4 border-2 border-blue-200 mb-4">
          <div className="flex items-center gap-2 mb-3">
            <Zap className="w-5 h-5 text-blue-600" />
            <span className="font-bold text-gray-800">æ™ºèƒ½æ¨è</span>
          </div>
          <div className="bg-white rounded-xl p-3 mb-2">
            <div className="flex items-start gap-2">
              <CheckCircle className="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" />
              <div>
                <div className="font-semibold text-sm text-gray-800 mb-1">
                  æœ€é€‚åˆä½ çš„å®å®ï¼šComotomoå¥¶ç“¶
                </div>
                <div className="text-xs text-gray-600">
                  â€¢ é˜²èƒ€æ°”æ•ˆæœæ›´å¥½ï¼Œé€‚åˆ3-6ä¸ªæœˆæ˜“èƒ€æ°”å®å®<br/>
                  â€¢ æŸ”è½¯åº¦æ¥è¿‘æ¯ä¹³ï¼Œå®å®æ¥å—åº¦é«˜<br/>
                  â€¢ è™½ç„¶ä»·æ ¼ç¨é«˜ï¼Œä½†ä½¿ç”¨ä½“éªŒæ›´å¥½
                </div>
              </div>
            </div>
          </div>
          <div className="text-xs text-gray-600">
            åŸºäºåŒæœˆé¾„å®å¦ˆçš„çœŸå®åé¦ˆå’Œä½ çš„éœ€æ±‚åˆ†æ
          </div>
        </div>

        {/* åŸºç¡€ä¿¡æ¯ */}
        {renderCompareSection(
          'çœŸå®ä½¿ç”¨æ•°æ®',
          <Users className="w-5 h-5 text-blue-600" />,
          'basic',
          renderBasicInfo()
        )}

        {/* åˆ†ç»´åº¦è¯„åˆ† */}
        {renderCompareSection(
          'åˆ†ç»´åº¦è¯„åˆ†',
          <Star className="w-5 h-5 text-yellow-500" />,
          'score',
          renderScores()
        )}

        {/* ä¼˜ç‚¹å¯¹æ¯” */}
        {renderCompareSection(
          'å¸¸è§ä¼˜ç‚¹',
          <ThumbsUp className="w-5 h-5 text-green-600" />,
          'pros',
          renderProsAndCons('pros')
        )}

        {/* ç¼ºç‚¹å¯¹æ¯” */}
        {renderCompareSection(
          'å¸¸è§ç¼ºç‚¹',
          <ThumbsDown className="w-5 h-5 text-red-600" />,
          'cons',
          renderProsAndCons('cons')
        )}

        {/* å‚æ•°å¯¹æ¯” */}
        {renderCompareSection(
          'äº§å“å‚æ•°',
          <AlertTriangle className="w-5 h-5 text-orange-600" />,
          'params',
          renderParams()
        )}

        {/* å…¶ä»–æ¨è */}
        <div className="bg-white rounded-2xl p-4 border border-gray-200">
          <h3 className="font-bold text-gray-800 mb-3">è¿˜å¯ä»¥çœ‹çœ‹è¿™äº›</h3>
          <div className="space-y-2">
            {alternatives.map((alt) => (
              <button
                key={alt.id}
                className="w-full bg-gray-50 rounded-xl p-3 flex items-center gap-3 hover:bg-gray-100 transition-all"
              >
                <div className="w-12 h-12 bg-white rounded-lg flex items-center justify-center text-2xl border border-gray-200">
                  {alt.image}
                </div>
                <div className="flex-1 text-left">
                  <div className="text-xs text-gray-500">{alt.brand}</div>
                  <div className="font-medium text-sm text-gray-800">{alt.name}</div>
                  <div className="flex items-center gap-2">
                    <span className="text-red-500 font-bold text-sm">Â¥{alt.price}</span>
                    <div className="flex items-center gap-1">
                      <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
                      <span className="text-xs">{alt.rating}</span>
                    </div>
                  </div>
                </div>
                <Plus className="w-5 h-5 text-blue-600" />
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* åº•éƒ¨æ“ä½œæ  */}
      <div className="bg-white border-t px-4 py-3 fixed bottom-0 left-0 right-0 max-w-md mx-auto z-50">
        <div className="flex gap-2">
          {products.filter(p => p !== null).map((product, index) => (
            <button
              key={product.id}
              className="flex-1 bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 rounded-xl font-semibold flex items-center justify-center gap-1"
            >
              <ShoppingCart className="w-4 h-4" />
              <span className="text-sm">Â¥{product.price}</span>
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};

export default ProductComparePage;
