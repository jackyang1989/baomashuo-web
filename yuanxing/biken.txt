import React, { useState } from 'react';
import { ArrowLeft, AlertTriangle, TrendingDown, Users, ThumbsDown, ChevronRight, Filter, Info, Search } from 'lucide-react';

const PitfallListPage = () => {
  const [activeTab, setActiveTab] = useState('age');
  const [selectedAge, setSelectedAge] = useState('3-6ä¸ªæœˆ');
  const [selectedCategory, setSelectedCategory] = useState('all');

  // æœˆé¾„åˆ†ç±»
  const ageGroups = ['0-3ä¸ªæœˆ', '3-6ä¸ªæœˆ', '6-12ä¸ªæœˆ', '1-2å²'];

  // äº§å“åˆ†ç±»
  const categories = [
    { id: 'all', name: 'å…¨éƒ¨', count: 23 },
    { id: 'bottle', name: 'å¥¶ç“¶', count: 8 },
    { id: 'bowl', name: 'è¾…é£Ÿç¢—', count: 5 },
    { id: 'toys', name: 'ç©å…·', count: 4 },
    { id: 'warmer', name: 'æ¸©å¥¶å™¨', count: 3 },
    { id: 'other', name: 'å…¶ä»–', count: 3 }
  ];

  // é¿å‘æ¦œå•æ•°æ®
  const pitfallProducts = [
    {
      id: 1,
      rank: 1,
      name: 'XXå“ç‰Œé˜²èƒ€æ°”å¥¶ç“¶',
      brand: 'XXå“ç‰Œ',
      image: 'ğŸ¼',
      notRecommendCount: 78,
      totalReviews: 145,
      notRecommendRate: 54,
      severity: 'high',
      mainIssues: [
        { issue: 'ä»ç„¶èƒ€æ°”ä¸¥é‡', percent: 42, count: 32 },
        { issue: 'å¥¶å˜´å¤ªç¡¬å®å®ä¸æ¥å—', percent: 36, count: 28 },
        { issue: 'æ¼å¥¶ä¸¥é‡', percent: 22, count: 18 }
      ],
      typicalCase: {
        user: 'å°é›¨å¦ˆå¦ˆ',
        age: '3ä¸ªæœˆå®å®',
        days: 15,
        summary: 'å®£ä¼ é˜²èƒ€æ°”ï¼Œä½†æˆ‘å®¶å®å®ç”¨äº†è¿˜æ˜¯èƒ€æ°”ï¼Œåæ¥æ¢äº†YYå“ç‰Œå°±å¥½äº†'
      },
      alternative: {
        name: 'YYå“ç‰Œé˜²èƒ€æ°”å¥¶ç“¶',
        recommendRate: 85,
        price: 98
      }
    },
    {
      id: 2,
      rank: 2,
      name: 'ZZç”µåŠ¨å¸å¥¶å™¨',
      brand: 'ZZå“ç‰Œ',
      image: 'ğŸ¤±',
      notRecommendCount: 124,
      totalReviews: 189,
      notRecommendRate: 66,
      severity: 'high',
      mainIssues: [
        { issue: 'ä½¿ç”¨1ä¸ªæœˆåæ•…éšœ', percent: 45, count: 56 },
        { issue: 'å¸åŠ›ä¸è¶³', percent: 32, count: 40 },
        { issue: 'å™ªéŸ³å¤ªå¤§', percent: 23, count: 28 }
      ],
      typicalCase: {
        user: 'æ™´å¤©å¦ˆå¦ˆ',
        age: 'äº§å2ä¸ªæœˆ',
        days: 30,
        summary: 'ç”¨äº†ä¸€ä¸ªæœˆå°±åäº†ï¼Œå®¢æœè¯´è¿‡ä¿ä¸ç»™æ¢ï¼Œæ°”æ­»äº†'
      },
      alternative: {
        name: 'AAå“ç‰Œå¸å¥¶å™¨',
        recommendRate: 78,
        price: 299
      }
    },
    {
      id: 3,
      rank: 3,
      name: 'BBå¸ç›˜è¾…é£Ÿç¢—',
      brand: 'BBå“ç‰Œ',
      image: 'ğŸ¥£',
      notRecommendCount: 89,
      totalReviews: 156,
      notRecommendRate: 57,
      severity: 'medium',
      mainIssues: [
        { issue: 'å¸ç›˜ä¸ç‰¢å›º', percent: 68, count: 60 },
        { issue: 'å®¹æ˜“æ‰“ç¿»', percent: 45, count: 40 },
        { issue: 'æ¸…æ´—éº»çƒ¦', percent: 25, count: 22 }
      ],
      typicalCase: {
        user: 'æš–æš–å¦ˆå’ª',
        age: '6ä¸ªæœˆå®å®',
        days: 7,
        summary: 'å¸ç›˜æ ¹æœ¬å¸ä¸ä½ï¼Œå®å®ä¸€æ‹‰å°±æ‰ï¼Œç”¨äº†3æ¬¡å°±é—²ç½®äº†'
      },
      alternative: {
        name: 'CCå“ç‰Œè¾…é£Ÿç¢—',
        recommendRate: 82,
        price: 68
      }
    },
    {
      id: 4,
      rank: 4,
      name: 'DDæ¸©å¥¶å™¨',
      brand: 'DDå“ç‰Œ',
      image: 'ğŸ”¥',
      notRecommendCount: 67,
      totalReviews: 203,
      notRecommendRate: 33,
      severity: 'medium',
      mainIssues: [
        { issue: 'å®é™…ä½¿ç”¨ç‡ä½', percent: 68, count: 46 },
        { issue: 'å ç©ºé—´', percent: 45, count: 30 },
        { issue: 'åŠŸèƒ½é¸¡è‚‹', percent: 28, count: 19 }
      ],
      typicalCase: {
        user: 'èŒèŒå¦ˆ',
        age: '4ä¸ªæœˆå®å®',
        days: 90,
        summary: 'ä¹°å›æ¥ç”¨äº†å‡ æ¬¡å°±é—²ç½®äº†ï¼Œç›´æ¥ç”¨çƒ­æ°´æ³¡ä¹Ÿèƒ½è§£å†³ï¼Œä¸å€¼å¾—ä¹°'
      },
      alternative: null
    }
  ];

  // åœºæ™¯é¿å‘
  const scenarioPitfalls = [
    {
      scenario: 'å¤œå¥¶åœºæ™¯',
      icon: 'ğŸŒ™',
      pitfalls: [
        { product: 'éœ€è¦æ’ç”µçš„æ¸©å¥¶å™¨', reason: 'å¤œé‡Œæ’ç”µä¸æ–¹ä¾¿', count: 45 },
        { product: 'ç»ç’ƒå¥¶ç“¶', reason: 'å¤œé‡Œå®¹æ˜“æ‘”ç¢', count: 38 }
      ]
    },
    {
      scenario: 'å¤–å‡ºåœºæ™¯',
      icon: 'ğŸš—',
      pitfalls: [
        { product: 'ä½“ç§¯è¿‡å¤§çš„æ¶ˆæ¯’å™¨', reason: 'å®Œå…¨å¸¦ä¸å‡ºå»', count: 56 },
        { product: 'æ˜“ç¢çš„ç»ç’ƒåˆ¶å“', reason: 'å¤–å‡ºå®¹æ˜“æ‘”å', count: 42 }
      ]
    },
    {
      scenario: 'è¾…é£ŸæœŸ',
      icon: 'ğŸš',
      pitfalls: [
        { product: 'å¸ç›˜ä¸ç‰¢çš„ç¢—', reason: 'å®å®ä¼šæ‹‰æ‰æ‰“ç¿»', count: 89 },
        { product: 'å¤ªæ·±çš„ç¢—', reason: 'å®å®å¤Ÿä¸åˆ°åº•éƒ¨', count: 34 }
      ]
    }
  ];

  const renderAgeTab = () => (
    <div className="p-4">
      {/* æœˆé¾„é€‰æ‹© */}
      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <h3 className="font-bold text-gray-800">é€‰æ‹©å®å®æœˆé¾„</h3>
          <Info className="w-4 h-4 text-gray-400" />
        </div>
        <div className="flex gap-2 overflow-x-auto pb-2">
          {ageGroups.map((age) => (
            <button
              key={age}
              onClick={() => setSelectedAge(age)}
              className={`px-4 py-2 rounded-xl font-medium whitespace-nowrap transition-all ${
                selectedAge === age
                  ? 'bg-red-500 text-white'
                  : 'bg-gray-100 text-gray-700'
              }`}
            >
              {age}
            </button>
          ))}
        </div>
      </div>

      {/* åˆ†ç±»ç­›é€‰ */}
      <div className="mb-4">
        <div className="flex gap-2 overflow-x-auto pb-2">
          {categories.map((cat) => (
            <button
              key={cat.id}
              onClick={() => setSelectedCategory(cat.id)}
              className={`px-3 py-1 rounded-full text-sm whitespace-nowrap transition-all ${
                selectedCategory === cat.id
                  ? 'bg-gray-800 text-white'
                  : 'bg-gray-100 text-gray-700'
              }`}
            >
              {cat.name}({cat.count})
            </button>
          ))}
        </div>
      </div>

      {/* æ¦œå•è¯´æ˜ */}
      <div className="bg-orange-50 border border-orange-200 rounded-xl p-3 mb-4">
        <div className="flex items-start gap-2">
          <Info className="w-4 h-4 text-orange-600 flex-shrink-0 mt-0.5" />
          <div className="text-xs text-orange-800">
            <div className="font-semibold mb-1">æ¦œå•è¯´æ˜</div>
            <div>åŸºäº{selectedAge}å®å®å®¶åº­çš„çœŸå®åé¦ˆï¼ŒæŒ‰ä¸æ¨èç‡æ’åºã€‚æ•°æ®æ¯å‘¨æ›´æ–°ï¼Œå¸®åŠ©ä½ é¿å¼€çœŸæ­£çš„å‘ã€‚</div>
          </div>
        </div>
      </div>

      {/* é¿å‘æ¦œå• */}
      <div className="space-y-3">
        {pitfallProducts.map((product) => (
          <div key={product.id} className="bg-white rounded-2xl p-4 border-2 border-red-200 shadow-sm">
            {/* æ’åå’Œä¸¥é‡ç¨‹åº¦ */}
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-2">
                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${
                  product.rank <= 3 
                    ? 'bg-red-500 text-white'
                    : 'bg-gray-500 text-white'
                }`}>
                  {product.rank}
                </div>
                <div className={`px-3 py-1 rounded-full text-xs font-semibold ${
                  product.severity === 'high'
                    ? 'bg-red-100 text-red-700'
                    : 'bg-orange-100 text-orange-700'
                }`}>
                  <AlertTriangle className="w-3 h-3 inline mr-1" />
                  {product.severity === 'high' ? 'é«˜é£é™©' : 'ä¸­é£é™©'}
                </div>
              </div>
              <TrendingDown className="w-5 h-5 text-red-500" />
            </div>

            {/* äº§å“ä¿¡æ¯ */}
            <div className="flex gap-3 mb-3">
              <div className="w-20 h-20 bg-gray-100 rounded-xl flex items-center justify-center text-4xl flex-shrink-0 border-2 border-red-200">
                {product.image}
              </div>
              <div className="flex-1">
                <div className="text-xs text-gray-500 mb-1">{product.brand}</div>
                <div className="font-semibold text-gray-800 mb-2 line-clamp-2">
                  {product.name}
                </div>
                <div className="flex items-center gap-3">
                  <div className="flex items-center gap-1 text-xs">
                    <Users className="w-3 h-3 text-gray-500" />
                    <span className="text-gray-600">{product.notRecommendCount}äººä¸æ¨è</span>
                  </div>
                  <div className="flex items-center gap-1 text-xs">
                    <ThumbsDown className="w-3 h-3 text-red-500" />
                    <span className="text-red-600 font-semibold">{product.notRecommendRate}%</span>
                  </div>
                </div>
              </div>
            </div>

            {/* ä¸»è¦é—®é¢˜ */}
            <div className="bg-red-50 rounded-xl p-3 mb-3">
              <div className="text-xs text-red-800 font-semibold mb-2">âš ï¸ ä¸»è¦é—®é¢˜</div>
              <div className="space-y-2">
                {product.mainIssues.map((issue, idx) => (
                  <div key={idx} className="flex items-center justify-between">
                    <div className="flex-1">
                      <div className="text-xs text-gray-700 mb-1">{issue.issue}</div>
                      <div className="bg-red-200 rounded-full h-1.5 overflow-hidden">
                        <div 
                          className="bg-red-500 h-full"
                          style={{ width: `${issue.percent}%` }}
                        ></div>
                      </div>
                    </div>
                    <div className="text-xs text-red-600 font-semibold ml-3 w-12 text-right">
                      {issue.percent}%
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* å…¸å‹æ¡ˆä¾‹ */}
            <div className="bg-gray-50 rounded-xl p-3 mb-3">
              <div className="text-xs text-gray-600 mb-2">
                <span className="font-semibold">{product.typicalCase.user}</span>
                <span className="mx-1">â€¢</span>
                <span>{product.typicalCase.age}</span>
                <span className="mx-1">â€¢</span>
                <span>ä½¿ç”¨{product.typicalCase.days}å¤©</span>
              </div>
              <div className="text-sm text-gray-800">
                "{product.typicalCase.summary}"
              </div>
            </div>

            {/* æ›¿ä»£æ¨è */}
            {product.alternative && (
              <div className="bg-green-50 border border-green-200 rounded-xl p-3">
                <div className="text-xs text-green-800 font-semibold mb-2">âœ“ åŒä»·ä½æ¨è</div>
                <div className="flex items-center justify-between">
                  <div className="flex-1">
                    <div className="text-sm font-semibold text-gray-800">{product.alternative.name}</div>
                    <div className="text-xs text-gray-600 mt-1">
                      æ¨èç‡ {product.alternative.recommendRate}% â€¢ Â¥{product.alternative.price}
                    </div>
                  </div>
                  <button className="ml-3 bg-green-600 text-white px-4 py-2 rounded-lg text-xs font-semibold whitespace-nowrap">
                    æŸ¥çœ‹è¯¦æƒ…
                  </button>
                </div>
              </div>
            )}

            {/* æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® */}
            <button className="w-full mt-3 text-sm text-gray-600 py-2 border border-gray-200 rounded-lg flex items-center justify-center gap-1">
              æŸ¥çœ‹å®Œæ•´é¿å‘è¯¦æƒ…
              <ChevronRight className="w-4 h-4" />
            </button>
          </div>
        ))}
      </div>

      {/* åŠ è½½æ›´å¤š */}
      <div className="text-center py-6">
        <button className="text-sm text-gray-600">
          æŸ¥çœ‹æ›´å¤š â†’
        </button>
      </div>
    </div>
  );

  const renderScenarioTab = () => (
    <div className="p-4">
      <div className="mb-4">
        <h3 className="font-bold text-gray-800 mb-2">æŒ‰åœºæ™¯é¿å‘</h3>
        <p className="text-sm text-gray-600">ä¸åŒåœºæ™¯ä¸‹çš„äº§å“é€‰æ‹©æœ‰è®²ç©¶</p>
      </div>

      <div className="space-y-4">
        {scenarioPitfalls.map((scenario, idx) => (
          <div key={idx} className="bg-white rounded-2xl p-4 border border-gray-200">
            <div className="flex items-center gap-2 mb-3">
              <div className="text-3xl">{scenario.icon}</div>
              <h4 className="font-bold text-gray-800">{scenario.scenario}</h4>
            </div>

            <div className="space-y-3">
              {scenario.pitfalls.map((pitfall, pidx) => (
                <div key={pidx} className="bg-red-50 border border-red-200 rounded-xl p-3">
                  <div className="flex items-start gap-2 mb-2">
                    <AlertTriangle className="w-4 h-4 text-red-600 flex-shrink-0 mt-0.5" />
                    <div className="flex-1">
                      <div className="font-semibold text-sm text-gray-800 mb-1">
                        {pitfall.product}
                      </div>
                      <div className="text-xs text-gray-700">
                        {pitfall.reason}
                      </div>
                    </div>
                  </div>
                  <div className="flex items-center gap-1 text-xs text-gray-600">
                    <Users className="w-3 h-3" />
                    <span>{pitfall.count}ä½å®å¦ˆåé¦ˆ</span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );

  const renderReasonTab = () => (
    <div className="p-4">
      <div className="mb-4">
        <h3 className="font-bold text-gray-800 mb-2">é«˜é¢‘è¸©å‘åŸå› </h3>
        <p className="text-sm text-gray-600">äº†è§£è¿™äº›ï¼Œå°‘èŠ±å†¤æ‰é’±</p>
      </div>

      <div className="space-y-3">
        {[
          {
            reason: 'è™šå‡å®£ä¼ ',
            desc: 'å®£ä¼ åŠŸèƒ½ä¸å®é™…æ•ˆæœä¸ç¬¦',
            count: 156,
            examples: ['é˜²èƒ€æ°”æ— æ•ˆ', 'æŠ—èŒåŠŸèƒ½å­˜ç–‘', 'æ™ºèƒ½åŠŸèƒ½é¸¡è‚‹']
          },
          {
            reason: 'è´¨é‡é—®é¢˜',
            desc: 'ä½¿ç”¨ä¸€æ®µæ—¶é—´åå‡ºç°æ•…éšœ',
            count: 124,
            examples: ['çŸ­æœŸå†…æŸå', 'æè´¨åŠ£åŒ–', 'åŠŸèƒ½å¤±æ•ˆ']
          },
          {
            reason: 'è®¾è®¡ç¼ºé™·',
            desc: 'äº§å“è®¾è®¡ä¸åˆç†å½±å“ä½¿ç”¨',
            count: 98,
            examples: ['å¸ç›˜ä¸ç‰¢', 'å®¹æ˜“æ‰“ç¿»', 'æ¸…æ´—å›°éš¾']
          },
          {
            reason: 'å®é™…ä½¿ç”¨ç‡ä½',
            desc: 'ä¹°äº†å‘ç°ç”¨ä¸ä¸Šï¼Œé—²ç½®ç‡é«˜',
            count: 203,
            examples: ['åŠŸèƒ½é‡å¤', 'å ç©ºé—´', 'ä½¿ç”¨åœºæ™¯å°‘']
          }
        ].map((item, idx) => (
          <div key={idx} className="bg-white rounded-xl p-4 border border-gray-200">
            <div className="flex items-center justify-between mb-2">
              <div className="font-bold text-gray-800">{item.reason}</div>
              <div className="text-sm text-red-600 font-semibold">{item.count}æ¬¡</div>
            </div>
            <div className="text-sm text-gray-600 mb-3">{item.desc}</div>
            <div className="flex flex-wrap gap-2">
              {item.examples.map((ex, eidx) => (
                <span key={eidx} className="text-xs bg-red-50 text-red-700 px-2 py-1 rounded">
                  {ex}
                </span>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );

  return (
    <div className="max-w-md mx-auto bg-gray-50 min-h-screen flex flex-col">
      {/* é¡¶éƒ¨å¯¼èˆª */}
      <div className="bg-gradient-to-r from-red-500 to-orange-500 px-4 py-4 text-white sticky top-0 z-50">
        <div className="flex items-center justify-between mb-3">
          <button className="flex items-center gap-2">
            <ArrowLeft className="w-5 h-5" />
            <span className="font-bold text-lg">é¿å‘æ¦œ</span>
          </button>
          <button>
            <Search className="w-5 h-5" />
          </button>
        </div>
        
        <div className="text-sm opacity-90">
          å¸®ä½ é¿å¼€{pitfallProducts.length * 3}ä¸ªçœŸå®çš„å‘
        </div>
      </div>

      {/* Tabå¯¼èˆª */}
      <div className="bg-white px-4 flex gap-6 border-b sticky top-16 z-40">
        <button
          onClick={() => setActiveTab('age')}
          className={`pb-3 font-medium transition-all ${
            activeTab === 'age'
              ? 'text-red-600 border-b-2 border-red-600'
              : 'text-gray-600'
          }`}
        >
          æŒ‰æœˆé¾„
        </button>
        <button
          onClick={() => setActiveTab('scenario')}
          className={`pb-3 font-medium transition-all ${
            activeTab === 'scenario'
              ? 'text-red-600 border-b-2 border-red-600'
              : 'text-gray-600'
          }`}
        >
          æŒ‰åœºæ™¯
        </button>
        <button
          onClick={() => setActiveTab('reason')}
          className={`pb-3 font-medium transition-all ${
            activeTab === 'reason'
              ? 'text-red-600 border-b-2 border-red-600'
              : 'text-gray-600'
          }`}
        >
          æŒ‰åŸå› 
        </button>
      </div>

      {/* å†…å®¹åŒºåŸŸ */}
      <div className="flex-1 overflow-y-auto">
        {activeTab === 'age' && renderAgeTab()}
        {activeTab === 'scenario' && renderScenarioTab()}
        {activeTab === 'reason' && renderReasonTab()}
      </div>

      {/* æäº¤é¿å‘æŒ‰é’® */}
      <div className="bg-white border-t px-4 py-3 sticky bottom-0 z-50">
        <button className="w-full bg-gradient-to-r from-red-500 to-orange-500 text-white py-3 rounded-xl font-semibold">
          æˆ‘ä¹Ÿè¦æäº¤é¿å‘äº§å“
        </button>
      </div>
    </div>
  );
};

export default PitfallListPage;
