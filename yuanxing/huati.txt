import React, { useState } from 'react';
import { ArrowLeft, MoreVertical, Share2, Bell, BellOff, TrendingUp, Users, MessageSquare, Heart, Eye, Calendar, Hash, Plus, Filter, Sparkles, Award, Crown, ChevronRight } from 'lucide-react';

const TopicDetailPage = () => {
  const [isFollowing, setIsFollowing] = useState(false);
  const [activeTab, setActiveTab] = useState('hot');
  const [showFilters, setShowFilters] = useState(false);

  // è¯é¢˜ä¿¡æ¯
  const topicInfo = {
    name: 'å®å®ç¡çœ ',
    icon: 'ğŸ˜´',
    description: 'åˆ†äº«å®å®ç¡çœ é—®é¢˜ã€ç¡çœ è®­ç»ƒæ–¹æ³•ã€ä½œæ¯è°ƒæ•´ç»éªŒã€‚ä»æ–°ç”Ÿå„¿åˆ°å¹¼å„¿ï¼Œå¸®åŠ©å®å®å’Œå¦ˆå¦ˆéƒ½ç¡ä¸ªå¥½è§‰ã€‚',
    cover: 'ğŸŒ™',
    stats: {
      posts: 2345,
      followers: 18923,
      todayPosts: 156,
      totalViews: 123456
    },
    tags: ['ç¡çœ è®­ç»ƒ', 'å“„ç¡æŠ€å·§', 'å¤œé†’', 'ä½œæ¯è§„å¾‹'],
    moderators: [
      { id: 1, name: 'è‚²å„¿ä¸“å®¶Lisa', avatar: 'ğŸ‘©â€âš•ï¸', role: 'expert' },
      { id: 2, name: 'å°é›¨å¦ˆå¦ˆ', avatar: 'ğŸ‘©', role: 'admin' }
    ],
    relatedTopics: [
      { id: 1, name: 'å®å®å“­é—¹', icon: 'ğŸ˜¢', posts: 1234 },
      { id: 2, name: 'è¾…é£Ÿæ·»åŠ ', icon: 'ğŸš', posts: 1890 },
      { id: 3, name: 'æ—©æ•™æ¸¸æˆ', icon: 'ğŸ®', posts: 1567 }
    ]
  };

  // çƒ­é—¨å¸–å­
  const posts = [
    {
      id: 1,
      type: 'share',
      user: { name: 'å°é›¨å¦ˆå¦ˆ', avatar: 'ğŸ‘©', level: 'Lv5', isExpert: false },
      title: 'ä»æ¯å°æ—¶é†’åˆ°ä¸€è§‰åˆ°å¤©äº®ï¼Œæˆ‘ç”¨3å‘¨è°ƒæ•´å®å®ç¡çœ ',
      content: 'åˆ†äº«æˆ‘å®¶å®å®ä»ç¡æ¸£åˆ°å¤©ä½¿å®å®çš„å…¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ä½œæ¯è°ƒæ•´ã€å“„ç¡æŠ€å·§...',
      images: ['ğŸ“¸', 'ğŸ“¸', 'ğŸ“¸'],
      likes: 1234,
      comments: 234,
      views: 5678,
      time: '2å¤©å‰',
      isPinned: true,
      isHot: true,
      tags: ['ç¡çœ è®­ç»ƒ', 'ä½œæ¯è§„å¾‹']
    },
    {
      id: 2,
      type: 'help',
      user: { name: 'æ™´å¤©å¦ˆå¦ˆ', avatar: 'ğŸ‘±â€â™€ï¸', level: 'Lv3', isExpert: false },
      title: 'å®å®4ä¸ªæœˆç¡çœ å€’é€€ï¼Œå¤œé†’é¢‘ç¹æ€ä¹ˆåŠï¼Ÿ',
      content: 'æœ€è¿‘ä¸€å‘¨å®å®çªç„¶å¼€å§‹é¢‘ç¹å¤œé†’ï¼Œæ¯1-2å°æ—¶å°±é†’ä¸€æ¬¡ï¼Œç™½å¤©ä¹Ÿç¡ä¸å¥½...',
      likes: 456,
      comments: 89,
      views: 2345,
      time: '5å°æ—¶å‰',
      hasAnswer: true,
      reward: 100,
      tags: ['å¤œé†’', '4ä¸ªæœˆ']
    },
    {
      id: 3,
      type: 'share',
      user: { name: 'è‚²å„¿ä¸“å®¶Lisa', avatar: 'ğŸ‘©â€âš•ï¸', level: 'Lv6', isExpert: true },
      title: 'ç§‘å­¦ç¡çœ è®­ç»ƒæŒ‡å—ï¼šä¸åŒæœˆé¾„çš„ä½œæ¯å®‰æ’',
      content: 'ä½œä¸ºå„¿ç§‘åŒ»ç”Ÿï¼Œæˆ‘æ€»ç»“äº†0-12ä¸ªæœˆå®å®çš„ç§‘å­¦ä½œæ¯å®‰æ’å’Œç¡çœ è®­ç»ƒæ–¹æ³•...',
      likes: 2345,
      comments: 456,
      views: 12345,
      time: '1å‘¨å‰',
      isRecommend: true,
      tags: ['ä¸“ä¸šæŒ‡å¯¼', 'ç¡çœ è®­ç»ƒ']
    }
  ];

  // æ´»è·ƒç”¨æˆ·
  const activeUsers = [
    { id: 1, name: 'å°é›¨å¦ˆå¦ˆ', avatar: 'ğŸ‘©', posts: 89, badge: 'ğŸ‘‘' },
    { id: 2, name: 'æ™´å¤©å¦ˆå¦ˆ', avatar: 'ğŸ‘±â€â™€ï¸', posts: 67, badge: 'ğŸ¥ˆ' },
    { id: 3, name: 'æš–æš–å¦ˆå’ª', avatar: 'ğŸ™‹â€â™€ï¸', posts: 54, badge: 'ğŸ¥‰' }
  ];

  const handleFollow = () => {
    setIsFollowing(!isFollowing);
  };

  const renderHeader = () => (
    <div className="bg-gradient-to-r from-indigo-500 to-purple-500 px-4 pt-4 pb-6 text-white">
      {/* å¯¼èˆªæ  */}
      <div className="flex items-center justify-between mb-4">
        <button>
          <ArrowLeft className="w-5 h-5" />
        </button>
        <div className="flex items-center gap-3">
          <button>
            <Share2 className="w-5 h-5" />
          </button>
          <button>
            <MoreVertical className="w-5 h-5" />
          </button>
        </div>
      </div>

      {/* è¯é¢˜ä¿¡æ¯ */}
      <div className="flex items-start gap-4 mb-4">
        <div className="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center text-5xl">
          {topicInfo.icon}
        </div>
        <div className="flex-1">
          <h1 className="text-2xl font-bold mb-2 flex items-center gap-2">
            <Hash className="w-5 h-5" />
            {topicInfo.name}
          </h1>
          <div className="text-sm opacity-90 leading-relaxed">
            {topicInfo.description}
          </div>
        </div>
      </div>

      {/* æ•°æ®ç»Ÿè®¡ */}
      <div className="grid grid-cols-4 gap-3 mb-4">
        <div className="text-center">
          <div className="text-xl font-bold">{topicInfo.stats.posts}</div>
          <div className="text-xs opacity-80">å¸–å­</div>
        </div>
        <div className="text-center">
          <div className="text-xl font-bold">{topicInfo.stats.followers}</div>
          <div className="text-xs opacity-80">å…³æ³¨</div>
        </div>
        <div className="text-center">
          <div className="text-xl font-bold text-yellow-300">+{topicInfo.stats.todayPosts}</div>
          <div className="text-xs opacity-80">ä»Šæ—¥æ–°å¢</div>
        </div>
        <div className="text-center">
          <div className="text-xl font-bold">{(topicInfo.stats.totalViews / 10000).toFixed(1)}w</div>
          <div className="text-xs opacity-80">æµè§ˆ</div>
        </div>
      </div>

      {/* æ“ä½œæŒ‰é’® */}
      <div className="flex gap-2">
        <button
          onClick={handleFollow}
          className={`flex-1 py-2.5 rounded-xl font-semibold transition-all ${
            isFollowing
              ? 'bg-white/30 text-white'
              : 'bg-white text-indigo-600'
          }`}
        >
          {isFollowing ? (
            <span className="flex items-center justify-center gap-1">
              <BellOff className="w-4 h-4" />
              å·²å…³æ³¨
            </span>
          ) : (
            <span className="flex items-center justify-center gap-1">
              <Bell className="w-4 h-4" />
              å…³æ³¨è¯é¢˜
            </span>
          )}
        </button>
        <button className="px-4 py-2.5 bg-white/30 rounded-xl">
          <Plus className="w-5 h-5" />
        </button>
      </div>
    </div>
  );

  const renderTags = () => (
    <div className="bg-white px-4 py-3 border-b">
      <div className="flex items-center gap-2 overflow-x-auto pb-1">
        <span className="text-xs text-gray-500 whitespace-nowrap">çƒ­é—¨æ ‡ç­¾ï¼š</span>
        {topicInfo.tags.map((tag, index) => (
          <button
            key={index}
            className="px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs whitespace-nowrap hover:bg-indigo-100 transition-all"
          >
            {tag}
          </button>
        ))}
      </div>
    </div>
  );

  const renderModerators = () => (
    <div className="bg-white px-4 py-4 border-b">
      <div className="flex items-center justify-between mb-3">
        <h3 className="font-bold text-gray-800 flex items-center gap-1">
          <Crown className="w-4 h-4 text-yellow-500" />
          è¯é¢˜ç®¡ç†å‘˜
        </h3>
      </div>
      <div className="flex gap-3">
        {topicInfo.moderators.map((mod) => (
          <button key={mod.id} className="flex items-center gap-2 bg-gray-50 rounded-lg px-3 py-2">
            <div className="text-2xl">{mod.avatar}</div>
            <div className="text-left">
              <div className="font-medium text-sm text-gray-800 flex items-center gap-1">
                {mod.name}
                {mod.role === 'expert' && (
                  <span className="text-xs bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded">
                    ä¸“å®¶
                  </span>
                )}
              </div>
              <div className="text-xs text-gray-500">
                {mod.role === 'expert' ? 'å„¿ç§‘åŒ»ç”Ÿ' : 'èµ„æ·±å®å¦ˆ'}
              </div>
            </div>
          </button>
        ))}
      </div>
    </div>
  );

  const renderActiveUsers = () => (
    <div className="bg-white px-4 py-4 border-b">
      <div className="flex items-center justify-between mb-3">
        <h3 className="font-bold text-gray-800 flex items-center gap-1">
          <Award className="w-4 h-4 text-orange-500" />
          æœ¬å‘¨æ´»è·ƒæ¦œ
        </h3>
        <button className="text-xs text-blue-600">æŸ¥çœ‹å…¨éƒ¨ â†’</button>
      </div>
      <div className="space-y-2">
        {activeUsers.map((user, index) => (
          <button
            key={user.id}
            className="w-full flex items-center gap-3 bg-gray-50 rounded-lg p-2 hover:bg-gray-100 transition-all"
          >
            <div className="text-xl">{user.badge}</div>
            <div className="text-2xl">{user.avatar}</div>
            <div className="flex-1 text-left">
              <div className="font-medium text-sm text-gray-800">{user.name}</div>
              <div className="text-xs text-gray-500">{user.posts}æ¡å†…å®¹</div>
            </div>
          </button>
        ))}
      </div>
    </div>
  );

  const renderPostCard = (post) => (
    <div key={post.id} className="bg-white border-b px-4 py-4 hover:bg-gray-50 transition-all">
      {/* ç½®é¡¶/æ¨èæ ‡è¯† */}
      {(post.isPinned || post.isRecommend) && (
        <div className="flex items-center gap-2 mb-2">
          {post.isPinned && (
            <span className="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded flex items-center gap-1">
              <TrendingUp className="w-3 h-3" />
              ç½®é¡¶
            </span>
          )}
          {post.isRecommend && (
            <span className="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded flex items-center gap-1">
              <Sparkles className="w-3 h-3" />
              ç²¾é€‰
            </span>
          )}
        </div>
      )}

      {/* ç”¨æˆ·ä¿¡æ¯ */}
      <div className="flex items-center gap-2 mb-3">
        <div className="text-xl">{post.user.avatar}</div>
        <div className="flex-1">
          <div className="flex items-center gap-2">
            <span className="font-semibold text-sm">{post.user.name}</span>
            <span className="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded">
              {post.user.level}
            </span>
            {post.user.isExpert && (
              <span className="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded">
                ä¸“å®¶
              </span>
            )}
          </div>
          <div className="text-xs text-gray-500">{post.time}</div>
        </div>
      </div>

      {/* å¸–å­æ ‡é¢˜å’Œå†…å®¹ */}
      <div className="mb-3">
        <div className="font-semibold text-base text-gray-800 mb-2 leading-snug">
          {post.title}
        </div>
        <div className="text-sm text-gray-600 line-clamp-2 leading-relaxed">
          {post.content}
        </div>
      </div>

      {/* å›¾ç‰‡ */}
      {post.images && (
        <div className="grid grid-cols-3 gap-2 mb-3">
          {post.images.map((img, idx) => (
            <div key={idx} className="aspect-square bg-gray-100 rounded-lg flex items-center justify-center text-3xl">
              {img}
            </div>
          ))}
        </div>
      )}

      {/* æ ‡ç­¾ */}
      {post.tags && (
        <div className="flex gap-2 mb-3">
          {post.tags.map((tag, idx) => (
            <span key={idx} className="text-xs bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded">
              {tag}
            </span>
          ))}
        </div>
      )}

      {/* äº’åŠ¨æ•°æ® */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4 text-xs text-gray-500">
          <span className="flex items-center gap-1">
            <Heart className="w-3 h-3" />
            {post.likes}
          </span>
          <span className="flex items-center gap-1">
            <MessageSquare className="w-3 h-3" />
            {post.comments}
          </span>
          <span className="flex items-center gap-1">
            <Eye className="w-3 h-3" />
            {post.views}
          </span>
        </div>
        {post.hasAnswer && (
          <span className="text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded">
            å·²è§£å†³
          </span>
        )}
        {post.reward && (
          <span className="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded">
            æ‚¬èµ{post.reward}ç§¯åˆ†
          </span>
        )}
      </div>
    </div>
  );

  const renderRelatedTopics = () => (
    <div className="bg-white px-4 py-4">
      <h3 className="font-bold text-gray-800 mb-3">ç›¸å…³è¯é¢˜</h3>
      <div className="space-y-2">
        {topicInfo.relatedTopics.map((topic) => (
          <button
            key={topic.id}
            className="w-full flex items-center gap-3 bg-gray-50 rounded-xl p-3 hover:bg-gray-100 transition-all"
          >
            <div className="w-10 h-10 bg-white rounded-lg flex items-center justify-center text-2xl border border-gray-200">
              {topic.icon}
            </div>
            <div className="flex-1 text-left">
              <div className="font-medium text-sm text-gray-800">#{topic.name}</div>
              <div className="text-xs text-gray-500">{topic.posts}æ¡å†…å®¹</div>
            </div>
            <ChevronRight className="w-5 h-5 text-gray-400" />
          </button>
        ))}
      </div>
    </div>
  );

  return (
    <div className="max-w-md mx-auto bg-gray-50 min-h-screen flex flex-col">
      {/* è¯é¢˜å¤´éƒ¨ */}
      {renderHeader()}

      {/* çƒ­é—¨æ ‡ç­¾ */}
      {renderTags()}

      {/* ç®¡ç†å‘˜ */}
      {renderModerators()}

      {/* æ´»è·ƒæ¦œ */}
      {renderActiveUsers()}

      {/* Tabå¯¼èˆª */}
      <div className="bg-white px-4 flex gap-6 border-b sticky top-0 z-40">
        <button
          onClick={() => setActiveTab('hot')}
          className={`pb-3 font-medium transition-all ${
            activeTab === 'hot'
              ? 'text-indigo-600 border-b-2 border-indigo-600'
              : 'text-gray-600'
          }`}
        >
          æœ€çƒ­
        </button>
        <button
          onClick={() => setActiveTab('latest')}
          className={`pb-3 font-medium transition-all ${
            activeTab === 'latest'
              ? 'text-indigo-600 border-b-2 border-indigo-600'
              : 'text-gray-600'
          }`}
        >
          æœ€æ–°
        </button>
        <button
          onClick={() => setActiveTab('recommend')}
          className={`pb-3 font-medium transition-all ${
            activeTab === 'recommend'
              ? 'text-indigo-600 border-b-2 border-indigo-600'
              : 'text-gray-600'
          }`}
        >
          ç²¾é€‰
        </button>
        <button className="ml-auto pb-3 text-gray-600">
          <Filter className="w-5 h-5" />
        </button>
      </div>

      {/* å¸–å­åˆ—è¡¨ */}
      <div className="flex-1 overflow-y-auto pb-20">
        {posts.map(renderPostCard)}

        {/* ç›¸å…³è¯é¢˜ */}
        {renderRelatedTopics()}
      </div>

      {/* åº•éƒ¨å‘å¸–æŒ‰é’® */}
      <div className="fixed bottom-20 right-4 z-50">
        <button className="w-14 h-14 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-full shadow-lg flex items-center justify-center">
          <Plus className="w-6 h-6" />
        </button>
      </div>
    </div>
  );
};

export default TopicDetailPage;
