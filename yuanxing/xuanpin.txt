import React, { useState } from 'react';
import { ArrowLeft, ChevronRight, CheckCircle, AlertCircle, HelpCircle, TrendingUp, Users, Star, Sparkles, Filter, Heart } from 'lucide-react';

const HowToChoosePage = () => {
  const [step, setStep] = useState(1);
  const [selections, setSelections] = useState({
    category: '',
    problem: '',
    budget: ''
  });

  // äº§å“åˆ†ç±»ï¼ˆç¬¬ä¸€æ­¥ï¼‰
  const categories = [
    { id: 'bottle', name: 'å¥¶ç“¶', icon: 'ğŸ¼', hot: true },
    { id: 'nipple', name: 'å¥¶å˜´', icon: 'ğŸ­' },
    { id: 'bowl', name: 'è¾…é£Ÿç¢—', icon: 'ğŸ¥£' },
    { id: 'warmer', name: 'æ¸©å¥¶å™¨', icon: 'ğŸ”¥' },
    { id: 'sterilizer', name: 'æ¶ˆæ¯’å™¨', icon: 'ğŸ’¨' },
    { id: 'brush', name: 'å¥¶ç“¶åˆ·', icon: 'ğŸ§¹' }
  ];

  // å¸¸è§é—®é¢˜ï¼ˆç¬¬äºŒæ­¥ï¼‰
  const problems = [
    { 
      id: 'colic', 
      title: 'èƒ€æ°”ä¸¥é‡', 
      desc: 'å®å®å–å¥¶åç»å¸¸èƒ€æ°”å“­é—¹',
      icon: 'ğŸ˜£',
      effectiveness: '76%æœ‰æ•ˆç‡'
    },
    { 
      id: 'refuse', 
      title: 'æ‹’ç»å¥¶ç“¶', 
      desc: 'å®å®ä¸æ¥å—å¥¶ç“¶å¥¶å˜´',
      icon: 'ğŸ˜¤',
      effectiveness: '68%æ¥å—åº¦'
    },
    { 
      id: 'leak', 
      title: 'æ¼å¥¶ä¸¥é‡', 
      desc: 'å¥¶ç“¶ç»å¸¸æ¼å¥¶å¼„æ¹¿è¡£æœ',
      icon: 'ğŸ’§',
      effectiveness: '92%é˜²æ¼'
    },
    { 
      id: 'first-time', 
      title: 'åˆšå¼€å§‹ç”¨', 
      desc: 'ç¬¬ä¸€æ¬¡ç»™å®å®é€‰å¥¶ç“¶',
      icon: 'ğŸ†•',
      effectiveness: 'æ–°æ‰‹æ¨è'
    }
  ];

  // é¢„ç®—èŒƒå›´ï¼ˆç¬¬ä¸‰æ­¥ï¼‰
  const budgets = [
    { id: 'low', range: '50å…ƒä»¥ä¸‹', icon: 'ğŸ’°' },
    { id: 'mid', range: '50-150å…ƒ', icon: 'ğŸ’°ğŸ’°', popular: true },
    { id: 'high', range: '150-300å…ƒ', icon: 'ğŸ’°ğŸ’°ğŸ’°' },
    { id: 'premium', range: '300å…ƒä»¥ä¸Š', icon: 'ğŸ’' }
  ];

  // æ¨èç»“æœï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
  const recommendations = [
    {
      id: 1,
      name: 'Comotomoå¯ä¹ˆå¤šä¹ˆç¡…èƒ¶å¥¶ç“¶',
      brand: 'Comotomo',
      image: 'ğŸ¼',
      price: 128,
      originalPrice: 189,
      rating: 4.8,
      reviewCount: 234,
      matchScore: 95,
      reasons: [
        '76%çš„åŒæœˆé¾„å¦ˆå¦ˆæ¨è',
        'é˜²èƒ€æ°”æœ‰æ•ˆç‡89%',
        'å®å®æ¥å—åº¦é«˜è¾¾92%'
      ],
      tags: ['é˜²èƒ€æ°”', 'æŸ”è½¯ä»¿æ¯ä¹³', 'æ˜“æ¸…æ´—'],
      userCount: 156,
      sameAgeRate: 76
    },
    {
      id: 2,
      name: 'Dr.Brownå¸ƒæœ—åšå£«é˜²èƒ€æ°”å¥¶ç“¶',
      brand: 'Dr.Brown',
      image: 'ğŸ¼',
      price: 98,
      originalPrice: 158,
      rating: 4.6,
      reviewCount: 189,
      matchScore: 88,
      reasons: [
        'ä¸“åˆ©é˜²èƒ€æ°”å¯¼ç®¡è®¾è®¡',
        'åŒ»ç”Ÿæ¨èç‡é«˜',
        'é€‚åˆèƒ€æ°”ä½“è´¨å®å®'
      ],
      tags: ['é˜²èƒ€æ°”', 'åŒ»ç”Ÿæ¨è', 'æ€§ä»·æ¯”é«˜'],
      userCount: 134,
      sameAgeRate: 68
    },
    {
      id: 3,
      name: 'NUKè‡ªç„¶å®æ„Ÿå®½å£å¾„å¥¶ç“¶',
      brand: 'NUK',
      image: 'ğŸ¼',
      price: 78,
      originalPrice: 128,
      rating: 4.5,
      reviewCount: 167,
      matchScore: 82,
      reasons: [
        'å¾·å›½å“ç‰Œï¼Œå“è´¨ä¿éšœ',
        'å®½å£è®¾è®¡æ˜“æ¸…æ´—',
        'ä»·æ ¼é€‚ä¸­æ€§ä»·æ¯”å¥½'
      ],
      tags: ['å®½å£å¾„', 'æ˜“æ¸…æ´—', 'å®æƒ '],
      userCount: 98,
      sameAgeRate: 62
    }
  ];

  const handleSelect = (key, value) => {
    setSelections({ ...selections, [key]: value });
  };

  const renderStep1 = () => (
    <div className="p-4">
      <div className="mb-4">
        <h2 className="text-xl font-bold text-gray-800 mb-2">é€‰æ‹©äº§å“ç±»å‹</h2>
        <p className="text-sm text-gray-500">ä»å¥¶ç“¶å¼€å§‹ï¼Œé€æ­¥æ‹“å±•åˆ°å…¶ä»–å“ç±»</p>
      </div>

      <div className="grid grid-cols-2 gap-3">
        {categories.map((cat) => (
          <button
            key={cat.id}
            onClick={() => {
              handleSelect('category', cat.id);
              setStep(2);
            }}
            className={`relative bg-white rounded-xl p-4 border-2 transition-all ${
              selections.category === cat.id
                ? 'border-blue-500 bg-blue-50'
                : 'border-gray-200 hover:border-blue-300'
            }`}
          >
            {cat.hot && (
              <div className="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full">
                çƒ­é—¨
              </div>
            )}
            <div className="text-4xl mb-2">{cat.icon}</div>
            <div className="font-semibold text-gray-800">{cat.name}</div>
          </button>
        ))}
      </div>
    </div>
  );

  const renderStep2 = () => (
    <div className="p-4">
      <div className="mb-4">
        <h2 className="text-xl font-bold text-gray-800 mb-2">ä½ é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2>
        <p className="text-sm text-gray-500">é€‰æ‹©æœ€å›°æ‰°ä½ çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¨èè§£å†³æ–¹æ¡ˆ</p>
      </div>

      <div className="space-y-3">
        {problems.map((problem) => (
          <button
            key={problem.id}
            onClick={() => {
              handleSelect('problem', problem.id);
              setStep(3);
            }}
            className={`w-full bg-white rounded-xl p-4 border-2 transition-all text-left ${
              selections.problem === problem.id
                ? 'border-blue-500 bg-blue-50'
                : 'border-gray-200 hover:border-blue-300'
            }`}
          >
            <div className="flex items-start gap-3">
              <div className="text-3xl">{problem.icon}</div>
              <div className="flex-1">
                <div className="flex items-center justify-between mb-1">
                  <span className="font-semibold text-gray-800">{problem.title}</span>
                  <span className="text-xs text-green-600 bg-green-50 px-2 py-1 rounded">
                    {problem.effectiveness}
                  </span>
                </div>
                <p className="text-sm text-gray-600">{problem.desc}</p>
              </div>
            </div>
          </button>
        ))}
      </div>

      <button
        onClick={() => setStep(3)}
        className="w-full mt-4 text-gray-600 text-sm py-2"
      >
        è·³è¿‡ï¼Œç›´æ¥çœ‹æ¨è â†’
      </button>
    </div>
  );

  const renderStep3 = () => (
    <div className="p-4">
      <div className="mb-4">
        <h2 className="text-xl font-bold text-gray-800 mb-2">é¢„ç®—èŒƒå›´</h2>
        <p className="text-sm text-gray-500">ä¸åŒä»·ä½éƒ½æœ‰å¥½é€‰æ‹©</p>
      </div>

      <div className="space-y-3">
        {budgets.map((budget) => (
          <button
            key={budget.id}
            onClick={() => {
              handleSelect('budget', budget.id);
              setStep(4);
            }}
            className={`w-full bg-white rounded-xl p-4 border-2 transition-all flex items-center justify-between ${
              selections.budget === budget.id
                ? 'border-blue-500 bg-blue-50'
                : 'border-gray-200 hover:border-blue-300'
            }`}
          >
            <div className="flex items-center gap-3">
              <div className="text-2xl">{budget.icon}</div>
              <span className="font-semibold text-gray-800">{budget.range}</span>
            </div>
            {budget.popular && (
              <span className="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded">
                æœ€å¤šé€‰æ‹©
              </span>
            )}
          </button>
        ))}
      </div>

      <button
        onClick={() => setStep(4)}
        className="w-full mt-4 text-gray-600 text-sm py-2"
      >
        é¢„ç®—ä¸é™ï¼Œçœ‹æ‰€æœ‰æ¨è â†’
      </button>
    </div>
  );

  const renderResults = () => (
    <div className="flex-1 overflow-y-auto">
      {/* ç­›é€‰æ¡ä»¶æ€»ç»“ */}
      <div className="bg-gradient-to-r from-blue-50 to-purple-50 p-4 border-b">
        <div className="flex items-center justify-between mb-3">
          <h2 className="text-lg font-bold text-gray-800">ä¸ºä½ æ¨è</h2>
          <button className="text-sm text-blue-600 flex items-center gap-1">
            <Filter className="w-4 h-4" />
            ç­›é€‰
          </button>
        </div>
        <div className="flex flex-wrap gap-2">
          <span className="text-xs bg-white px-3 py-1 rounded-full text-gray-700">
            3-6ä¸ªæœˆå®å®
          </span>
          <span className="text-xs bg-white px-3 py-1 rounded-full text-gray-700">
            é˜²èƒ€æ°”é—®é¢˜
          </span>
          <span className="text-xs bg-white px-3 py-1 rounded-full text-gray-700">
            50-150å…ƒé¢„ç®—
          </span>
        </div>
        <div className="mt-2 text-sm text-gray-600">
          æ‰¾åˆ° <span className="text-blue-600 font-semibold">3ä¸ª</span> ç¬¦åˆæ¡ä»¶çš„äº§å“
        </div>
      </div>

      {/* æ¨èäº§å“åˆ—è¡¨ */}
      <div className="p-4 space-y-4">
        {recommendations.map((product, index) => (
          <div key={product.id} className="bg-white rounded-2xl p-4 shadow-md border border-gray-200">
            {/* åŒ¹é…åº¦æ ‡ç­¾ */}
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-2">
                <span className="text-lg font-bold text-blue-600">#{index + 1}</span>
                <div className={`px-3 py-1 rounded-full text-xs font-semibold ${
                  product.matchScore >= 90 
                    ? 'bg-green-100 text-green-700'
                    : product.matchScore >= 80
                    ? 'bg-blue-100 text-blue-700'
                    : 'bg-gray-100 text-gray-700'
                }`}>
                  <Sparkles className="w-3 h-3 inline mr-1" />
                  åŒ¹é…åº¦ {product.matchScore}%
                </div>
              </div>
              <button className="text-gray-400">
                <Heart className="w-5 h-5" />
              </button>
            </div>

            {/* äº§å“ä¿¡æ¯å¡ç‰‡ */}
            <div className="flex gap-3 mb-3">
              <div className="w-24 h-24 bg-gray-100 rounded-xl flex items-center justify-center text-5xl flex-shrink-0 border border-gray-200">
                {product.image}
              </div>
              <div className="flex-1">
                <div className="text-xs text-gray-500 mb-1">{product.brand}</div>
                <div className="font-semibold text-gray-800 mb-2 line-clamp-2">
                  {product.name}
                </div>
                <div className="flex items-center gap-2 mb-2">
                  <span className="text-red-500 font-bold text-lg">Â¥{product.price}</span>
                  <span className="text-xs text-gray-400 line-through">Â¥{product.originalPrice}</span>
                  <span className="text-xs text-red-500 bg-red-50 px-2 py-0.5 rounded">
                    çœ{product.originalPrice - product.price}å…ƒ
                  </span>
                </div>
                <div className="flex items-center gap-1 text-xs text-gray-500">
                  <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
                  <span className="font-semibold">{product.rating}</span>
                  <span>â€¢</span>
                  <span>{product.reviewCount}æ¡è¯„ä»·</span>
                </div>
              </div>
            </div>

            {/* æ¨èç†ç”± */}
            <div className="bg-blue-50 rounded-xl p-3 mb-3">
              <div className="text-xs text-blue-800 font-semibold mb-2">ğŸ’¡ ä¸ºä»€ä¹ˆæ¨è</div>
              <div className="space-y-1">
                {product.reasons.map((reason, idx) => (
                  <div key={idx} className="flex items-start gap-2 text-xs text-gray-700">
                    <CheckCircle className="w-3 h-3 text-green-600 flex-shrink-0 mt-0.5" />
                    <span>{reason}</span>
                  </div>
                ))}
              </div>
            </div>

            {/* åŒæœˆé¾„æ•°æ® */}
            <div className="flex items-center gap-4 mb-3 text-xs">
              <div className="flex items-center gap-1 text-gray-600">
                <Users className="w-4 h-4" />
                <span>{product.userCount}ä½å®å¦ˆä½¿ç”¨</span>
              </div>
              <div className="flex items-center gap-1 text-green-600">
                <TrendingUp className="w-4 h-4" />
                <span>åŒæœˆé¾„æ¨èç‡{product.sameAgeRate}%</span>
              </div>
            </div>

            {/* æ ‡ç­¾ */}
            <div className="flex flex-wrap gap-2 mb-3">
              {product.tags.map((tag, idx) => (
                <span key={idx} className="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded">
                  {tag}
                </span>
              ))}
            </div>

            {/* æ“ä½œæŒ‰é’® */}
            <div className="flex gap-2">
              <button className="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-xl font-semibold text-sm">
                æŸ¥çœ‹è¯¦æƒ…
              </button>
              <button className="px-4 bg-gray-100 text-gray-700 py-3 rounded-xl font-semibold text-sm">
                å¯¹æ¯”
              </button>
            </div>
          </div>
        ))}
      </div>

      {/* æŸ¥çœ‹æ›´å¤š */}
      <div className="p-4 text-center">
        <button className="text-sm text-gray-600">
          æŸ¥çœ‹æ›´å¤šäº§å“ â†’
        </button>
      </div>
    </div>
  );

  return (
    <div className="max-w-md mx-auto bg-gray-50 h-screen flex flex-col">
      {/* é¡¶éƒ¨å¯¼èˆª */}
      <div className="bg-white px-4 py-3 flex items-center justify-between shadow-sm">
        <button className="flex items-center gap-2 text-gray-800">
          <ArrowLeft className="w-5 h-5" />
          <span className="font-semibold">æ€ä¹ˆé€‰</span>
        </button>
        <div className="flex items-center gap-2">
          <HelpCircle className="w-5 h-5 text-gray-400" />
        </div>
      </div>

      {/* è¿›åº¦æ¡ */}
      {step < 4 && (
        <div className="bg-white px-4 py-3 border-b">
          <div className="flex items-center justify-between mb-2">
            <span className="text-sm text-gray-600">ç¬¬ {step} æ­¥ï¼Œå…± 3 æ­¥</span>
            <span className="text-xs text-gray-500">å¯éšæ—¶è·³è¿‡</span>
          </div>
          <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
            <div 
              className="h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300"
              style={{ width: `${(step / 3) * 100}%` }}
            />
          </div>
        </div>
      )}

      {/* å†…å®¹åŒºåŸŸ */}
      <div className="flex-1 overflow-y-auto">
        {step === 1 && renderStep1()}
        {step === 2 && renderStep2()}
        {step === 3 && renderStep3()}
        {step === 4 && renderResults()}
      </div>

      {/* åº•éƒ¨æ“ä½œæ ï¼ˆéç»“æœé¡µæ˜¾ç¤ºï¼‰ */}
      {step > 1 && step < 4 && (
        <div className="bg-white border-t px-4 py-3">
          <button
            onClick={() => setStep(step - 1)}
            className="w-full py-3 text-gray-600 border border-gray-300 rounded-xl font-semibold"
          >
            ä¸Šä¸€æ­¥
          </button>
        </div>
      )}
    </div>
  );
};

export default HowToChoosePage;
