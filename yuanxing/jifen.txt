import React, { useState } from 'react';
import { ArrowLeft, Gift, TrendingUp, Clock, Users, Star, ChevronRight, Sparkles, Award, Zap, Package, ShoppingCart, AlertCircle, CheckCircle, Trophy, Crown, Target } from 'lucide-react';

const PointsStorePage = () => {
  const [activeTab, setActiveTab] = useState('all');
  const [selectedProduct, setSelectedProduct] = useState(null);

  // ç”¨æˆ·ç§¯åˆ†ä¿¡æ¯
  const userPoints = {
    current: 2850,
    total: 5670,
    thisMonth: 420,
    rank: 156,
    level: 'Lv5'
  };

  // å•†å“åˆ†ç±»
  const categories = [
    { id: 'all', name: 'å…¨éƒ¨', icon: 'ğŸ' },
    { id: 'samples', name: 'è¯•ç”¨è£…', icon: 'ğŸ§´' },
    { id: 'goods', name: 'å®ç‰©', icon: 'ğŸ“¦' },
    { id: 'coupons', name: 'ä¼˜æƒ åˆ¸', icon: 'ğŸŸï¸' },
    { id: 'vip', name: 'VIP', icon: 'ğŸ‘‘' }
  ];

  // ç§¯åˆ†å•†å“
  const products = [
    {
      id: 1,
      name: 'å¥¶ç²‰è¯•ç”¨è£…',
      brand: 'çˆ±ä»–ç¾',
      image: 'ğŸ¼',
      points: 500,
      originalPrice: 39,
      stock: 23,
      limit: 1,
      tag: 'çƒ­å…‘',
      redeemCount: 1234,
      category: 'samples'
    },
    {
      id: 2,
      name: 'çº¸å°¿è£¤è¯•ç”¨è£…',
      brand: 'å¥½å¥‡',
      image: 'ğŸ§·',
      points: 300,
      originalPrice: 25,
      stock: 45,
      limit: 1,
      tag: 'æ–°å“',
      redeemCount: 892,
      category: 'samples'
    },
    {
      id: 3,
      name: 'å®å®è¢œå­3åŒè£…',
      brand: 'ç«¥æ³°',
      image: 'ğŸ§¦',
      points: 800,
      originalPrice: 45,
      stock: 12,
      limit: 2,
      tag: null,
      redeemCount: 567,
      category: 'goods'
    },
    {
      id: 4,
      name: 'å¹³å°10å…ƒä¼˜æƒ åˆ¸',
      brand: 'å®å¦ˆè¯´',
      image: 'ğŸŸï¸',
      points: 500,
      originalPrice: 10,
      stock: 999,
      limit: 3,
      tag: 'æ— é—¨æ§›',
      redeemCount: 3456,
      category: 'coupons'
    },
    {
      id: 5,
      name: 'VIPä¼šå‘˜7å¤©ä½“éªŒ',
      brand: 'å®å¦ˆè¯´',
      image: 'ğŸ‘‘',
      points: 1000,
      originalPrice: 19,
      stock: 100,
      limit: 1,
      tag: 'é™æ—¶',
      redeemCount: 234,
      category: 'vip'
    },
    {
      id: 6,
      name: '10å…ƒå¾®ä¿¡çº¢åŒ…',
      brand: 'ç°é‡‘',
      image: 'ğŸ’°',
      points: 10000,
      originalPrice: 10,
      stock: 50,
      limit: 2,
      tag: 'å®å',
      redeemCount: 89,
      category: 'goods',
      needVerify: true
    }
  ];

  // ç§¯åˆ†ä»»åŠ¡
  const tasks = [
    {
      id: 1,
      name: 'æ¯æ—¥ç­¾åˆ°',
      points: 10,
      icon: 'ğŸ“…',
      progress: 1,
      total: 1,
      status: 'completed'
    },
    {
      id: 2,
      name: 'å‘å¸ƒè¯„ä»·',
      points: 50,
      icon: 'âœï¸',
      progress: 2,
      total: 5,
      status: 'ongoing'
    },
    {
      id: 3,
      name: 'å‘å¸ƒå¸–å­',
      points: 20,
      icon: 'ğŸ“',
      progress: 1,
      total: 3,
      status: 'ongoing'
    },
    {
      id: 4,
      name: 'é‚€è¯·å¥½å‹',
      points: 100,
      icon: 'ğŸ‘¥',
      progress: 0,
      total: 1,
      status: 'available'
    }
  ];

  // å…‘æ¢è®°å½•
  const redemptions = [
    {
      id: 1,
      product: 'å¥¶ç²‰è¯•ç”¨è£…',
      points: 500,
      status: 'shipped',
      time: '2å¤©å‰',
      trackingNo: 'SF1234567890'
    },
    {
      id: 2,
      product: 'å¹³å°10å…ƒä¼˜æƒ åˆ¸',
      points: 500,
      status: 'completed',
      time: '5å¤©å‰'
    }
  ];

  const handleRedeem = (product) => {
    setSelectedProduct(product);
  };

  const confirmRedeem = () => {
    // å…‘æ¢é€»è¾‘
    setSelectedProduct(null);
  };

  const filteredProducts = activeTab === 'all' 
    ? products 
    : products.filter(p => p.category === activeTab);

  const renderHeader = () => (
    <div className="bg-gradient-to-r from-orange-500 to-red-500 px-4 pt-4 pb-6 text-white">
      <div className="flex items-center justify-between mb-4">
        <button className="flex items-center gap-2">
          <ArrowLeft className="w-5 h-5" />
          <span className="font-bold text-lg">ç§¯åˆ†å•†åŸ</span>
        </button>
        <button className="text-sm">
          å…‘æ¢è®°å½• â†’
        </button>
      </div>

      {/* ç§¯åˆ†å¡ç‰‡ */}
      <div className="bg-white/20 backdrop-blur-sm rounded-2xl p-4">
        <div className="flex items-center justify-between mb-3">
          <div>
            <div className="text-sm opacity-90 mb-1">æˆ‘çš„ç§¯åˆ†</div>
            <div className="text-4xl font-bold">{userPoints.current.toLocaleString()}</div>
          </div>
          <div className="text-right">
            <div className="flex items-center gap-1 mb-1">
              <Award className="w-4 h-4" />
              <span className="text-sm">{userPoints.level}</span>
            </div>
            <div className="text-xs opacity-90">æ’å #{userPoints.rank}</div>
          </div>
        </div>

        <div className="grid grid-cols-3 gap-3 pt-3 border-t border-white/30">
          <div className="text-center">
            <div className="text-xl font-bold">{userPoints.total.toLocaleString()}</div>
            <div className="text-xs opacity-80">ç´¯è®¡è·å¾—</div>
          </div>
          <div className="text-center">
            <div className="text-xl font-bold text-yellow-300">+{userPoints.thisMonth}</div>
            <div className="text-xs opacity-80">æœ¬æœˆæ–°å¢</div>
          </div>
          <div className="text-center">
            <button className="text-xl font-bold text-yellow-300">
              <TrendingUp className="w-5 h-5 inline" />
            </button>
            <div className="text-xs opacity-80">è·å–æ”»ç•¥</div>
          </div>
        </div>
      </div>
    </div>
  );

  const renderTasks = () => (
    <div className="bg-white mx-4 mt-4 rounded-2xl p-4 border border-orange-200">
      <div className="flex items-center justify-between mb-3">
        <div className="flex items-center gap-2">
          <Target className="w-5 h-5 text-orange-600" />
          <h3 className="font-bold text-gray-800">æ¯æ—¥ä»»åŠ¡</h3>
        </div>
        <span className="text-xs text-orange-600 bg-orange-50 px-2 py-1 rounded-full">
          ä»Šæ—¥å¯å¾— 180ç§¯åˆ†
        </span>
      </div>

      <div className="space-y-2">
        {tasks.map((task) => (
          <div key={task.id} className="bg-gradient-to-r from-orange-50 to-yellow-50 rounded-xl p-3">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="text-2xl">{task.icon}</div>
                <div>
                  <div className="font-medium text-sm text-gray-800">{task.name}</div>
                  <div className="text-xs text-gray-500">
                    å¥–åŠ± <span className="text-orange-600 font-semibold">+{task.points}ç§¯åˆ†</span>
                  </div>
                </div>
              </div>
              {task.status === 'completed' ? (
                <div className="flex items-center gap-1 text-green-600 text-xs bg-green-50 px-3 py-1 rounded-full">
                  <CheckCircle className="w-3 h-3" />
                  <span>å·²å®Œæˆ</span>
                </div>
              ) : task.status === 'ongoing' ? (
                <div className="text-right">
                  <div className="text-xs text-gray-500 mb-1">{task.progress}/{task.total}</div>
                  <button className="text-xs text-blue-600 bg-blue-50 px-3 py-1 rounded-full">
                    å»å®Œæˆ
                  </button>
                </div>
              ) : (
                <button className="text-xs text-orange-600 bg-orange-50 px-3 py-1 rounded-full font-medium">
                  å»å®Œæˆ
                </button>
              )}
            </div>
          </div>
        ))}
      </div>
    </div>
  );

  const renderProducts = () => (
    <div className="p-4">
      {/* åˆ†ç±»Tab */}
      <div className="flex gap-2 overflow-x-auto pb-3 mb-4">
        {categories.map((cat) => (
          <button
            key={cat.id}
            onClick={() => setActiveTab(cat.id)}
            className={`flex items-center gap-1 px-4 py-2 rounded-full whitespace-nowrap transition-all ${
              activeTab === cat.id
                ? 'bg-orange-500 text-white'
                : 'bg-gray-100 text-gray-700'
            }`}
          >
            <span>{cat.icon}</span>
            <span className="text-sm font-medium">{cat.name}</span>
          </button>
        ))}
      </div>

      {/* å•†å“ç½‘æ ¼ */}
      <div className="grid grid-cols-2 gap-3">
        {filteredProducts.map((product) => (
          <div key={product.id} className="bg-white rounded-2xl border border-gray-200 overflow-hidden">
            {/* æ ‡ç­¾ */}
            {product.tag && (
              <div className={`absolute top-0 right-0 px-2 py-1 text-xs font-semibold text-white rounded-bl-lg ${
                product.tag === 'çƒ­å…‘' ? 'bg-red-500' :
                product.tag === 'æ–°å“' ? 'bg-blue-500' :
                product.tag === 'é™æ—¶' ? 'bg-purple-500' :
                product.tag === 'æ— é—¨æ§›' ? 'bg-green-500' :
                'bg-orange-500'
              }`}>
                {product.tag}
              </div>
            )}

            {/* å•†å“å›¾ç‰‡ */}
            <div className="relative">
              <div className="aspect-square bg-gray-100 flex items-center justify-center text-6xl">
                {product.image}
              </div>
            </div>

            {/* å•†å“ä¿¡æ¯ */}
            <div className="p-3">
              <div className="text-xs text-gray-500 mb-1">{product.brand}</div>
              <div className="font-semibold text-sm text-gray-800 mb-2 line-clamp-2 h-10">
                {product.name}
              </div>

              {/* ä»·æ ¼ */}
              <div className="flex items-baseline gap-1 mb-2">
                <span className="text-xl font-bold text-orange-600">{product.points}</span>
                <span className="text-xs text-gray-500">ç§¯åˆ†</span>
                <span className="text-xs text-gray-400 line-through ml-auto">Â¥{product.originalPrice}</span>
              </div>

              {/* å…‘æ¢ä¿¡æ¯ */}
              <div className="flex items-center justify-between text-xs text-gray-500 mb-3">
                <span className="flex items-center gap-1">
                  <Users className="w-3 h-3" />
                  {product.redeemCount}äººå…‘æ¢
                </span>
                <span className={product.stock < 20 ? 'text-red-500' : ''}>
                  å‰©{product.stock}ä»¶
                </span>
              </div>

              {/* å…‘æ¢æŒ‰é’® */}
              <button
                onClick={() => handleRedeem(product)}
                disabled={product.points > userPoints.current || product.stock === 0}
                className={`w-full py-2 rounded-lg text-sm font-semibold transition-all ${
                  product.points > userPoints.current
                    ? 'bg-gray-200 text-gray-400'
                    : product.stock === 0
                    ? 'bg-gray-200 text-gray-400'
                    : 'bg-gradient-to-r from-orange-500 to-red-500 text-white'
                }`}
              >
                {product.stock === 0 ? 'å·²å…‘å®Œ' :
                 product.points > userPoints.current ? 'ç§¯åˆ†ä¸è¶³' : 'ç«‹å³å…‘æ¢'}
              </button>

              {product.limit && (
                <div className="text-xs text-orange-600 text-center mt-2">
                  æ¯äººé™å…‘{product.limit}ä»¶
                </div>
              )}
            </div>
          </div>
        ))}
      </div>

      {/* åŠ è½½æ›´å¤š */}
      <div className="text-center py-6">
        <button className="text-sm text-gray-600">
          æŸ¥çœ‹æ›´å¤šå•†å“ â†’
        </button>
      </div>
    </div>
  );

  const renderRedeemModal = () => {
    if (!selectedProduct) return null;

    return (
      <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
        <div className="bg-white rounded-2xl max-w-sm w-full">
          <div className="p-6">
            <div className="text-center mb-4">
              <div className="text-6xl mb-3">{selectedProduct.image}</div>
              <div className="font-bold text-lg text-gray-800 mb-1">
                {selectedProduct.name}
              </div>
              <div className="text-sm text-gray-600">{selectedProduct.brand}</div>
            </div>

            <div className="bg-orange-50 rounded-xl p-4 mb-4">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-gray-700">å…‘æ¢æ‰€éœ€</span>
                <div className="flex items-baseline gap-1">
                  <span className="text-2xl font-bold text-orange-600">{selectedProduct.points}</span>
                  <span className="text-sm text-gray-600">ç§¯åˆ†</span>
                </div>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-sm text-gray-700">å½“å‰ç§¯åˆ†</span>
                <span className="text-sm font-semibold text-gray-800">{userPoints.current.toLocaleString()}</span>
              </div>
              <div className="flex items-center justify-between pt-2 mt-2 border-t border-orange-200">
                <span className="text-sm text-gray-700">å…‘æ¢åå‰©ä½™</span>
                <span className="text-lg font-bold text-blue-600">
                  {(userPoints.current - selectedProduct.points).toLocaleString()}
                </span>
              </div>
            </div>

            {selectedProduct.needVerify && (
              <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-3 mb-4">
                <div className="flex items-start gap-2">
                  <AlertCircle className="w-4 h-4 text-yellow-600 flex-shrink-0 mt-0.5" />
                  <div className="text-xs text-yellow-800">
                    <div className="font-semibold mb-1">éœ€è¦å®åè®¤è¯</div>
                    <div>å…‘æ¢ç°é‡‘çº¢åŒ…éœ€è¦å®Œæˆå®åè®¤è¯æ‰èƒ½æç°</div>
                  </div>
                </div>
              </div>
            )}

            <div className="text-xs text-gray-500 mb-4">
              <div className="flex items-center gap-1 mb-1">
                <Package className="w-3 h-3" />
                <span>é¢„è®¡3-7å¤©å‘è´§</span>
              </div>
              {selectedProduct.limit && (
                <div className="flex items-center gap-1">
                  <AlertCircle className="w-3 h-3" />
                  <span>æ¯äººé™å…‘{selectedProduct.limit}ä»¶</span>
                </div>
              )}
            </div>

            <div className="flex gap-2">
              <button
                onClick={() => setSelectedProduct(null)}
                className="flex-1 py-3 border border-gray-300 rounded-xl text-gray-700 font-semibold"
              >
                å–æ¶ˆ
              </button>
              <button
                onClick={confirmRedeem}
                className="flex-1 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl font-semibold"
              >
                ç¡®è®¤å…‘æ¢
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  };

  return (
    <div className="max-w-md mx-auto bg-gray-50 min-h-screen flex flex-col">
      {/* é¡¶éƒ¨ç§¯åˆ†ä¿¡æ¯ */}
      {renderHeader()}

      {/* æ¯æ—¥ä»»åŠ¡ */}
      {renderTasks()}

      {/* ç§¯åˆ†è§„åˆ™è¯´æ˜ */}
      <div className="mx-4 mt-4 bg-blue-50 border border-blue-200 rounded-xl p-3">
        <div className="flex items-start gap-2">
          <Sparkles className="w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5" />
          <div className="text-xs text-blue-800">
            <div className="font-semibold mb-1">ç§¯åˆ†è·å–æ–¹å¼</div>
            <div>â€¢ æ¯æ—¥ç­¾åˆ° +10åˆ†</div>
            <div>â€¢ å‘å¸ƒè¯„ä»· +50åˆ†</div>
            <div>â€¢ å‘å¸ƒå¸–å­ +20åˆ†</div>
            <div>â€¢ é‚€è¯·å¥½å‹ +100åˆ†</div>
            <div>â€¢ ä¼˜è´¨å†…å®¹é¢å¤–å¥–åŠ±</div>
          </div>
        </div>
      </div>

      {/* å•†å“åˆ—è¡¨ */}
      <div className="flex-1 overflow-y-auto pb-4">
        {renderProducts()}
      </div>

      {/* å…‘æ¢å¼¹çª— */}
      {renderRedeemModal()}

      {/* åº•éƒ¨å¯¼èˆªå ä½ */}
      <div className="h-16"></div>
    </div>
  );
};

export default PointsStorePage;
