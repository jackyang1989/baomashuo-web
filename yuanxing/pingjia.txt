import React, { useState } from 'react';
import { ArrowLeft, X, Camera, ChevronRight, Star, HelpCircle, AlertCircle, CheckCircle, Upload, Search } from 'lucide-react';

const ReviewPublishPage = () => {
  const [step, setStep] = useState(1);
  const [formData, setFormData] = useState({
    product: null,
    useDays: '',
    babyAge: '3ä¸ªæœˆ',
    rating: null,
    dimensions: {
      safety: 0,
      effectiveness: 0,
      acceptance: 0,
      value: 0,
      durability: 0
    },
    summary: '',
    detail: '',
    photos: [],
    tags: [],
    replaceFrom: '',
    replaceReason: '',
    stillUsing: null,
    wouldRepurchase: null
  });

  const searchResults = [
    { id: 1, name: 'Comotomoå¯ä¹ˆå¤šä¹ˆç¡…èƒ¶å¥¶ç“¶ 250ml', brand: 'Comotomo', image: 'ğŸ¼' },
    { id: 2, name: 'Dr.Brownå¸ƒæœ—åšå£«é˜²èƒ€æ°”å¥¶ç“¶', brand: 'Dr.Brown', image: 'ğŸ¼' },
    { id: 3, name: 'NUKè‡ªç„¶å®æ„Ÿå®½å£å¾„å¥¶ç“¶', brand: 'NUK', image: 'ğŸ¼' }
  ];

  const useDurationOptions = [
    { value: '7', label: '1å‘¨ä»¥å†…', badge: 'æ–°æ‰‹' },
    { value: '30', label: '1ä¸ªæœˆ', badge: 'ä½“éªŒæœŸ' },
    { value: '90', label: '3ä¸ªæœˆ', badge: 'é•¿æœŸ' },
    { value: '180', label: 'åŠå¹´+', badge: 'èµ„æ·±' }
  ];

  const ratingOptions = [
    { value: 'recommend', label: 'æ¨è', color: 'bg-green-500', icon: 'ğŸ‘' },
    { value: 'not-recommend', label: 'ä¸æ¨è', color: 'bg-red-500', icon: 'ğŸ‘' },
    { value: 'optional', label: 'å¯é€‰', color: 'bg-gray-500', icon: 'ğŸ¤·' }
  ];

  const quickTags = {
    positive: ['é˜²èƒ€æ°”æœ‰æ•ˆ', 'æ˜“æ¸…æ´—', 'å®å®æ¥å—åº¦é«˜', 'è´¨é‡å¥½', 'æ€§ä»·æ¯”é«˜', 'è€ç”¨'],
    negative: ['èƒ€æ°”ä¸¥é‡', 'æ¸…æ´—éº»çƒ¦', 'å®å®ä¸æ¥å—', 'å®¹æ˜“å', 'ä»·æ ¼è´µ', 'æ¼å¥¶']
  };

  const handleSelectProduct = (product) => {
    setFormData({ ...formData, product });
    setStep(2);
  };

  const handleDimensionScore = (dimension, score) => {
    setFormData({
      ...formData,
      dimensions: { ...formData.dimensions, [dimension]: score }
    });
  };

  const toggleTag = (tag) => {
    const tags = formData.tags.includes(tag)
      ? formData.tags.filter(t => t !== tag)
      : [...formData.tags, tag];
    setFormData({ ...formData, tags });
  };

  const renderStep1 = () => (
    <div className="p-4">
      <div className="mb-4">
        <h2 className="text-xl font-bold text-gray-800 mb-2">é€‰æ‹©äº§å“</h2>
        <p className="text-sm text-gray-600">æœç´¢ä½ è¦è¯„ä»·çš„äº§å“</p>
      </div>

      <div className="relative mb-4">
        <Search className="w-5 h-5 text-gray-400 absolute left-3 top-3" />
        <input
          type="text"
          placeholder="è¾“å…¥äº§å“åç§°æœç´¢..."
          className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500"
        />
      </div>

      <div className="bg-blue-50 border border-blue-200 rounded-xl p-3 mb-4">
        <div className="flex items-start gap-2">
          <HelpCircle className="w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5" />
          <div className="text-xs text-blue-800">
            <div className="font-semibold mb-1">è¯„ä»·å¥–åŠ±</div>
            <div>â€¢ ä½¿ç”¨30å¤©ä»¥ä¸Šè¯„ä»·æƒé‡æ›´é«˜</div>
            <div>â€¢ ä¼˜è´¨è¯„ä»·å¯è·å¾—é¢å¤–ç§¯åˆ†</div>
          </div>
        </div>
      </div>

      <div className="space-y-2">
        {searchResults.map((product) => (
          <button
            key={product.id}
            onClick={() => handleSelectProduct(product)}
            className="w-full bg-white rounded-xl p-3 border border-gray-200 hover:border-blue-500 transition-all text-left"
          >
            <div className="flex items-center gap-3">
              <div className="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center text-3xl">
                {product.image}
              </div>
              <div className="flex-1">
                <div className="text-xs text-gray-500 mb-1">{product.brand}</div>
                <div className="font-medium text-gray-800 text-sm">{product.name}</div>
              </div>
              <ChevronRight className="w-5 h-5 text-gray-400" />
            </div>
          </button>
        ))}
      </div>
    </div>
  );

  const renderStep2 = () => (
    <div className="p-4">
      <div className="mb-4">
        <h2 className="text-xl font-bold text-gray-800 mb-2">åŸºç¡€ä¿¡æ¯</h2>
        <p className="text-sm text-gray-600">è¿™äº›ä¿¡æ¯å¸®åŠ©å…¶ä»–å®å¦ˆåˆ¤æ–­å‚è€ƒä»·å€¼</p>
      </div>

      {formData.product && (
        <div className="bg-gray-50 rounded-xl p-3 mb-4 border border-gray-200">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 bg-white rounded-lg flex items-center justify-center text-2xl">
              {formData.product.image}
            </div>
            <div className="flex-1">
              <div className="text-xs text-gray-500">{formData.product.brand}</div>
              <div className="font-medium text-sm text-gray-800">{formData.product.name}</div>
            </div>
            <button onClick={() => setStep(1)} className="text-blue-600 text-sm">
              æ›´æ¢
            </button>
          </div>
        </div>
      )}

      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">ä½¿ç”¨æ—¶é•¿</label>
          <span className="text-red-500">*</span>
        </div>
        <div className="grid grid-cols-2 gap-3">
          {useDurationOptions.map((option) => (
            <button
              key={option.value}
              onClick={() => setFormData({ ...formData, useDays: option.value })}
              className={`p-3 rounded-xl border-2 transition-all ${
                formData.useDays === option.value
                  ? 'border-blue-500 bg-blue-50'
                  : 'border-gray-200 bg-white'
              }`}
            >
              <div className="font-semibold text-gray-800 mb-1">{option.label}</div>
              <div className="text-xs text-blue-600">{option.badge}</div>
            </button>
          ))}
        </div>
      </div>

      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">å®å®æœˆé¾„</label>
          <span className="text-red-500">*</span>
        </div>
        <div className="bg-gray-50 rounded-xl p-3 border border-gray-200">
          <div className="flex items-center justify-between">
            <span className="text-gray-800">ä½¿ç”¨æ—¶å®å®</span>
            <button className="text-blue-600 font-semibold">
              {formData.babyAge} â†’
            </button>
          </div>
        </div>
      </div>

      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">è´­ä¹°å‡­è¯</label>
          <span className="text-xs text-gray-500">é€‰å¡«</span>
        </div>
        <button className="w-full border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-blue-500 transition-all">
          <Upload className="w-8 h-8 text-gray-400 mx-auto mb-2" />
          <div className="text-sm text-gray-600">ä¸Šä¼ è®¢å•æˆªå›¾</div>
          <div className="text-xs text-gray-400 mt-1">è·å¾—è®¤è¯å¾½ç« </div>
        </button>
      </div>

      <button
        onClick={() => setStep(3)}
        disabled={!formData.useDays}
        className={`w-full py-3 rounded-xl font-semibold ${
          formData.useDays
            ? 'bg-blue-500 text-white'
            : 'bg-gray-200 text-gray-400'
        }`}
      >
        ä¸‹ä¸€æ­¥
      </button>
    </div>
  );

  const renderStep3 = () => (
    <div className="p-4">
      <div className="mb-4">
        <h2 className="text-xl font-bold text-gray-800 mb-2">äº§å“è¯„åˆ†</h2>
        <p className="text-sm text-gray-600">åˆ†ç»´åº¦è¯„åˆ†æ›´æœ‰å‚è€ƒä»·å€¼</p>
      </div>

      <div className="mb-6">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">ä½ çš„æ€åº¦</label>
          <span className="text-red-500">*</span>
        </div>
        <div className="grid grid-cols-3 gap-3">
          {ratingOptions.map((option) => (
            <button
              key={option.value}
              onClick={() => setFormData({ ...formData, rating: option.value })}
              className={`p-4 rounded-xl border-2 transition-all ${
                formData.rating === option.value
                  ? `${option.color} text-white`
                  : 'border-gray-200 bg-white text-gray-800'
              }`}
            >
              <div className="text-3xl mb-2">{option.icon}</div>
              <div className="font-semibold">{option.label}</div>
            </button>
          ))}
        </div>
      </div>

      <div className="space-y-4 mb-6">
        {[
          { key: 'safety', label: 'å®‰å…¨æ€§' },
          { key: 'effectiveness', label: 'å®ç”¨æ€§' },
          { key: 'acceptance', label: 'å®å®æ¥å—åº¦' },
          { key: 'value', label: 'æ€§ä»·æ¯”' },
          { key: 'durability', label: 'è€ç”¨æ€§' }
        ].map((dimension) => (
          <div key={dimension.key}>
            <div className="flex items-center justify-between mb-2">
              <div className="font-medium text-gray-800">{dimension.label}</div>
              <div className="text-lg font-bold text-blue-600">
                {formData.dimensions[dimension.key]}.0
              </div>
            </div>
            <div className="flex gap-2">
              {[1, 2, 3, 4, 5].map((score) => (
                <button
                  key={score}
                  onClick={() => handleDimensionScore(dimension.key, score)}
                  className="flex-1"
                >
                  <Star
                    className={`w-8 h-8 mx-auto ${
                      score <= formData.dimensions[dimension.key]
                        ? 'fill-yellow-400 text-yellow-400'
                        : 'text-gray-300'
                    }`}
                  />
                </button>
              ))}
            </div>
          </div>
        ))}
      </div>

      <button
        onClick={() => setStep(4)}
        disabled={!formData.rating}
        className={`w-full py-3 rounded-xl font-semibold ${
          formData.rating
            ? 'bg-blue-500 text-white'
            : 'bg-gray-200 text-gray-400'
        }`}
      >
        ä¸‹ä¸€æ­¥
      </button>
    </div>
  );

  const renderStep4 = () => (
    <div className="p-4">
      <div className="mb-4">
        <h2 className="text-xl font-bold text-gray-800 mb-2">è¯¦ç»†è¯„ä»·</h2>
        <p className="text-sm text-gray-600">åˆ†äº«ä½ çš„çœŸå®ä½“éªŒ</p>
      </div>

      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">ä¸€å¥è¯æ€»ç»“</label>
          <span className="text-red-500">*</span>
        </div>
        <input
          type="text"
          maxLength={50}
          value={formData.summary}
          onChange={(e) => setFormData({ ...formData, summary: e.target.value })}
          placeholder="ä¾‹å¦‚ï¼šé˜²èƒ€æ°”æœ‰æ•ˆï¼Œå®å®æ¥å—åº¦é«˜"
          className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500"
        />
        <div className="text-xs text-gray-400 text-right mt-1">
          {formData.summary.length}/50
        </div>
      </div>

      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">è¯¦ç»†è¯„ä»·</label>
          <span className="text-red-500">*</span>
        </div>
        <textarea
          value={formData.detail}
          onChange={(e) => setFormData({ ...formData, detail: e.target.value })}
          placeholder="åˆ†äº«ä½¿ç”¨æ„Ÿå—ã€å®å®ååº”ã€ä¼˜ç¼ºç‚¹..."
          className="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 h-32 resize-none"
        />
        <div className="text-xs text-gray-400 text-right mt-1">
          {formData.detail.length}/500
        </div>
      </div>

      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">ä¸Šä¼ å›¾ç‰‡</label>
          <span className="text-xs text-gray-500">æœ€å¤š9å¼ </span>
        </div>
        <div className="grid grid-cols-3 gap-3">
          {formData.photos.length < 9 && (
            <button className="aspect-square border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center hover:border-blue-500 transition-all">
              <Camera className="w-6 h-6 text-gray-400 mb-1" />
              <span className="text-xs text-gray-400">æ·»åŠ </span>
            </button>
          )}
        </div>
      </div>

      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">å¿«é€Ÿæ ‡ç­¾</label>
        </div>
        <div className="space-y-3">
          <div>
            <div className="text-xs text-green-700 mb-2">ä¼˜ç‚¹</div>
            <div className="flex flex-wrap gap-2">
              {quickTags.positive.map((tag) => (
                <button
                  key={tag}
                  onClick={() => toggleTag(tag)}
                  className={`px-3 py-1 rounded-full text-xs transition-all ${
                    formData.tags.includes(tag)
                      ? 'bg-green-500 text-white'
                      : 'bg-green-50 text-green-700'
                  }`}
                >
                  {tag}
                </button>
              ))}
            </div>
          </div>
          <div>
            <div className="text-xs text-red-700 mb-2">ç¼ºç‚¹</div>
            <div className="flex flex-wrap gap-2">
              {quickTags.negative.map((tag) => (
                <button
                  key={tag}
                  onClick={() => toggleTag(tag)}
                  className={`px-3 py-1 rounded-full text-xs transition-all ${
                    formData.tags.includes(tag)
                      ? 'bg-red-500 text-white'
                      : 'bg-red-50 text-red-700'
                  }`}
                >
                  {tag}
                </button>
              ))}
            </div>
          </div>
        </div>
      </div>

      <button
        onClick={() => setStep(5)}
        disabled={formData.summary.length < 10 || formData.detail.length < 50}
        className={`w-full py-3 rounded-xl font-semibold ${
          formData.summary.length >= 10 && formData.detail.length >= 50
            ? 'bg-blue-500 text-white'
            : 'bg-gray-200 text-gray-400'
        }`}
      >
        ä¸‹ä¸€æ­¥
      </button>
    </div>
  );

  const renderStep5 = () => (
    <div className="p-4">
      <div className="mb-4">
        <h2 className="text-xl font-bold text-gray-800 mb-2">å…³é”®ä¿¡æ¯</h2>
        <p className="text-sm text-gray-600">å¯è·³è¿‡</p>
      </div>

      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">æ˜¯å¦ä»å…¶ä»–äº§å“æ¢è¿‡æ¥</label>
        </div>
        <div className="space-y-3">
          <button
            onClick={() => setFormData({ ...formData, replaceFrom: 'yes' })}
            className={`w-full p-3 rounded-xl border-2 text-left ${
              formData.replaceFrom === 'yes'
                ? 'border-blue-500 bg-blue-50'
                : 'border-gray-200 bg-white'
            }`}
          >
            æ˜¯ï¼Œæˆ‘ä¹‹å‰ç”¨è¿‡å…¶ä»–äº§å“
          </button>
          {formData.replaceFrom === 'yes' && (
            <div className="space-y-2">
              <input
                type="text"
                placeholder="ä¹‹å‰ç”¨çš„ä»€ä¹ˆï¼Ÿ"
                className="w-full px-4 py-3 border border-gray-300 rounded-xl"
              />
              <input
                type="text"
                placeholder="ä¸ºä»€ä¹ˆæ¢ï¼Ÿ"
                className="w-full px-4 py-3 border border-gray-300 rounded-xl"
              />
            </div>
          )}
          <button
            onClick={() => setFormData({ ...formData, replaceFrom: 'no' })}
            className={`w-full p-3 rounded-xl border-2 text-left ${
              formData.replaceFrom === 'no'
                ? 'border-blue-500 bg-blue-50'
                : 'border-gray-200 bg-white'
            }`}
          >
            ä¸æ˜¯ï¼Œç¬¬ä¸€æ¬¡ç”¨
          </button>
        </div>
      </div>

      <div className="mb-4">
        <div className="flex items-center gap-2 mb-3">
          <label className="font-semibold text-gray-800">ç°åœ¨è¿˜åœ¨ç”¨å—</label>
        </div>
        <div className="space-y-2">
          <button
            onClick={() => setFormData({ ...formData, stillUsing: true })}
            className={`w-full p-3 rounded-xl border-2 text-left ${
              formData.stillUsing === true
                ? 'border-green-500 bg-green-50'
                : 'border-gray-200 bg-white'
            }`}
          >
            <div className="flex items-center gap-2">
              <CheckCircle className="w-5 h-5 text-green-600" />
              <span>æ˜¯ï¼Œä»åœ¨ä½¿ç”¨</span>
            </div>
          </button>
          <button
            onClick={() => setFormData({ ...formData, stillUsing: false })}
            className={`w-full p-3 rounded-xl border-2 text-left ${
              formData.stillUsing === false
                ? 'border-red-500 bg-red-50'
                : 'border-gray-200 bg-white'
            }`}
          >
            <div className="flex items-center gap-2">
              <AlertCircle className="w-5 h-5 text-red-600" />
              <span>ä¸ç”¨äº†ï¼Œå·²å¼ƒç”¨</span>
            </div>
          </button>
        </div>
      </div>

      <div className="space-y-2">
        <button
          onClick={() => setStep(6)}
          className="w-full bg-blue-500 text-white py-3 rounded-xl font-semibold"
        >
          ç»§ç»­
        </button>
        <button
          onClick={() => setStep(6)}
          className="w-full text-gray-600 py-2"
        >
          è·³è¿‡
        </button>
      </div>
    </div>
  );

  const renderStep6 = () => (
    <div className="p-4">
      <div className="mb-4">
        <h2 className="text-xl font-bold text-gray-800 mb-2">é¢„è§ˆ</h2>
      </div>

      <div className="bg-white rounded-2xl p-4 border border-gray-200 mb-4">
        <div className="flex items-center justify-between mb-3">
          <div className="flex items-center gap-2">
            <div className="text-2xl">ğŸ‘©</div>
            <div>
              <div className="font-medium text-sm">ä½ </div>
              <div className="text-xs text-gray-500">
                {formData.babyAge}å®å® Â· å·²ä½¿ç”¨ {formData.useDays} å¤©
              </div>
            </div>
          </div>
          <div className={`px-3 py-1 rounded-lg text-xs font-medium ${
            formData.rating === 'recommend' 
              ? 'bg-green-100 text-green-700'
              : 'bg-red-100 text-red-700'
          }`}>
            {formData.rating === 'recommend' ? 'æ¨è' : 'ä¸æ¨è'}
          </div>
        </div>

        <div className="bg-blue-50 p-2 rounded-lg mb-3 text-sm">
          ğŸ’¬ {formData.summary}
        </div>

        <div className="text-sm text-gray-600 mb-3">
          {formData.detail}
        </div>

        {formData.tags.length > 0 && (
          <div className="flex flex-wrap gap-2">
            {formData.tags.map((tag, idx) => (
              <span key={idx} className="text-xs px-2 py-1 bg-gray-100 rounded">
                {tag}
              </span>
            ))}
          </div>
        )}
      </div>

      <div className="bg-yellow-50 rounded-xl p-4 mb-4 border border-yellow-200">
        <div className="font-bold text-gray-800 mb-2">ğŸ è·å¾—å¥–åŠ±</div>
        <div className="space-y-1 text-sm">
          <div>â€¢ å‘å¸ƒè¯„ä»·ï¼š+50ç§¯åˆ†</div>
          <div className="pt-2 border-t font-bold text-orange-600">
            å…±è®¡ï¼š+50ç§¯åˆ†
          </div>
        </div>
      </div>

      <button className="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-4 rounded-xl font-bold">
        å‘å¸ƒè¯„ä»·
      </button>
    </div>
  );

  return (
    <div className="max-w-md mx-auto bg-gray-50 min-h-screen flex flex-col">
      <div className="bg-white px-4 py-3 flex items-center justify-between shadow-sm sticky top-0 z-50">
        <button className="flex items-center gap-2">
          <ArrowLeft className="w-5 h-5" />
          <span className="font-semibold">å‘å¸ƒè¯„ä»·</span>
        </button>
        <button className="text-gray-600 text-sm">
          è‰ç¨¿
        </button>
      </div>

      {step < 6 && (
        <div className="bg-white px-4 py-3 border-b">
          <div className="flex items-center justify-between mb-2">
            <span className="text-sm text-gray-600">ç¬¬ {step} æ­¥ï¼Œå…± 5 æ­¥</span>
          </div>
          <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
            <div 
              className="h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all"
              style={{ width: `${(step / 5) * 100}%` }}
            />
          </div>
        </div>
      )}

      <div className="flex-1 overflow-y-auto">
        {step === 1 && renderStep1()}
        {step === 2 && renderStep2()}
        {step === 3 && renderStep3()}
        {step === 4 && renderStep4()}
        {step === 5 && renderStep5()}
        {step === 6 && renderStep6()}
      </div>
    </div>
  );
};

export default ReviewPublishPage;
